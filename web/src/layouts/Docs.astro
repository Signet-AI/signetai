---
import Base from './Base.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import Sidebar from '../components/docs/Sidebar.astro';
import '../styles/docs.css';

interface Props {
  title: string;
  description?: string;
  currentSlug?: string;
  currentSection?: string;
  toc?: {
    depth: number;
    slug: string;
    text: string;
  }[];
  previousDoc?: {
    title: string;
    url: string;
  };
  nextDoc?: {
    title: string;
    url: string;
  };
}

const {
  title,
  description,
  currentSlug,
  currentSection,
  toc,
  previousDoc,
  nextDoc,
} = Astro.props;
---

<Base title={`${title} â€” Signet Docs`} description={description}>
  <Nav />

  <div class="docs-shell" data-has-toc={toc && toc.length > 0 ? "true" : undefined}>
    <Sidebar currentSlug={currentSlug} />

    <main class="docs-main">
      <header class="docs-article-header">
        <p class="docs-kicker">
          <a href="/docs">Docs</a>
          {currentSection ? <span>/ {currentSection}</span> : null}
        </p>
        <h1>{title}</h1>
        {description ? <p class="docs-description">{description}</p> : null}
      </header>

      {toc && toc.length > 0 ? (
        <nav class="docs-inpage" aria-label="On this page">
          <p>On this page</p>
          <ol>
            {toc.map((item) => (
              <li class={item.depth >= 3 ? 'toc-subitem' : undefined}>
                <a href={`#${item.slug}`}>{item.text}</a>
              </li>
            ))}
          </ol>
        </nav>
      ) : null}

      <article class="prose">
        <slot />
      </article>

      {(previousDoc || nextDoc) ? (
        <nav class="docs-pager" aria-label="Page navigation">
          {previousDoc ? (
            <a class="docs-pager-link" href={previousDoc.url} rel="prev">
              <span class="docs-pager-label">Previous</span>
              <span class="docs-pager-title">{previousDoc.title}</span>
            </a>
          ) : <span class="docs-pager-spacer"></span>}

          {nextDoc ? (
            <a class="docs-pager-link" href={nextDoc.url} rel="next">
              <span class="docs-pager-label">Next</span>
              <span class="docs-pager-title">{nextDoc.title}</span>
            </a>
          ) : <span class="docs-pager-spacer"></span>}
        </nav>
      ) : null}

      <Footer />
    </main>

    {toc && toc.length > 0 ? (
      <aside class="docs-toc-rail" aria-label="Table of contents">
        <p class="docs-toc-rail-heading">On this page</p>
        <ol class="docs-toc-rail-list">
          {toc.map((item) => (
            <li class={item.depth >= 3 ? 'toc-rail-subitem' : undefined}>
              <a href={`#${item.slug}`}>{item.text}</a>
            </li>
          ))}
        </ol>
      </aside>
    ) : null}
  </div>

  <script src="../scripts/docs-toc.ts"></script>
</Base>
