import{a as Wt,f as ne,d as Pe}from"../chunks/CejlkohN.js";import{a as ir,i as sn,h as se,q as We,B as on,j as xn,L as Z,k as jn,n as kn,o as Pr,t as Ke,e as $e,$ as an,as as Rn,ab as Or,c as Te,aM as _e,b as Mr,aN as In,s as Tn,aE as zn,aO as Pn,aq as Rr,aP as On,aQ as Fn,aI as Cn,_ as Fr,aR as Dn,r as ln,p as un,aS as gr,aT as Ln,ap as qn,d as Vn,am as Er,aU as Bn,x as $n,aV as Un,aW as An,aX as Yn,aY as Wn,aZ as Kn,aJ as Nr,g as Qn,w as Xn,a_ as Gn,P as Jn,ay as kt,u as tr,aK as Zt,ax as er,Q as ge,U as Zn,V as jt,v as Hn,a$ as ti,b0 as ei,X as Dt,W as xt,b1 as ri,aL as mr,ac as rr,y as nr}from"../chunks/DOXm6QVJ.js";import{d as ni,e as ii,a as Ne,s as Ht}from"../chunks/QHD0JZ7V.js";import{i as we,b as si}from"../chunks/CLc--whT.js";function vr(s,u){return u}function oi(s,u,g){for(var v=[],m=u.length,_,D=u.length,V=0;V<m;V++){let rt=u[V];un(rt,()=>{if(_){if(_.pending.delete(rt),_.done.add(rt),_.pending.size===0){var E=s.outrogroups;xr(Rr(_.done)),E.delete(_),E.size===0&&(s.outrogroups=null)}}else D-=1},!1)}if(D===0){var K=v.length===0&&g!==null;if(K){var F=g,Y=F.parentNode;qn(Y),Y.append(F),s.items.clear()}xr(u,!K)}else _={pending:new Set(u),done:new Set},(s.outrogroups??=new Set).add(_)}function xr(s,u=!0){for(var g=0;g<s.length;g++)Vn(s[g],u)}var Cr;function pr(s,u,g,v,m,_=null){var D=s,V=new Map;{var K=s;D=se?We(on(K)):K.appendChild(ir())}se&&xn();var F=null,Y=zn(()=>{var y=g();return Pn(y)?y:y==null?[]:Rr(y)}),rt,E=!0;function L(){j.fallback=F,ai(j,rt,D,u,v),F!==null&&(rt.length===0?(F.f&_e)===0?ln(F):(F.f^=_e,Ue(F,null,D)):un(F,()=>{F=null}))}var R=sn(()=>{rt=Z(Y);var y=rt.length;let I=!1;if(se){var P=jn(D)===kn;P!==(y===0)&&(D=Pr(),We(D),Ke(!1),I=!0)}for(var M=new Set,c=Te,w=Tn(),d=0;d<y;d+=1){se&&$e.nodeType===an&&$e.data===Rn&&(D=$e,I=!0,Ke(!1));var O=rt[d],q=v(O,d),X=E?null:V.get(q);X?(X.v&&Or(X.v,O),X.i&&Or(X.i,d),w&&c.unskip_effect(X.e)):(X=li(V,E?D:Cr??=ir(),O,q,d,m,u,g),E||(X.e.f|=_e),V.set(q,X)),M.add(q)}if(y===0&&_&&!F&&(E?F=Mr(()=>_(D)):(F=Mr(()=>_(Cr??=ir())),F.f|=_e)),y>M.size&&In(),se&&y>0&&We(Pr()),!E)if(w){for(const[C,S]of V)M.has(C)||c.skip_effect(S.e);c.oncommit(L),c.ondiscard(()=>{})}else L();I&&Ke(!0),Z(Y)}),j={effect:R,items:V,outrogroups:null,fallback:F};E=!1,se&&(D=$e)}function Ve(s){for(;s!==null&&(s.f&Ln)===0;)s=s.next;return s}function ai(s,u,g,v,m){var _=u.length,D=s.items,V=Ve(s.effect.first),K,F=null,Y=[],rt=[],E,L,R,j;for(j=0;j<_;j+=1){if(E=u[j],L=m(E,j),R=D.get(L).e,s.outrogroups!==null)for(const q of s.outrogroups)q.pending.delete(R),q.done.delete(R);if((R.f&_e)!==0)if(R.f^=_e,R===V)Ue(R,null,g);else{var y=F?F.next:V;R===s.effect.last&&(s.effect.last=R.prev),R.prev&&(R.prev.next=R.next),R.next&&(R.next.prev=R.prev),be(s,F,R),be(s,R,y),Ue(R,y,g),F=R,Y=[],rt=[],V=Ve(F.next);continue}if((R.f&gr)!==0&&ln(R),R!==V){if(K!==void 0&&K.has(R)){if(Y.length<rt.length){var I=rt[0],P;F=I.prev;var M=Y[0],c=Y[Y.length-1];for(P=0;P<Y.length;P+=1)Ue(Y[P],I,g);for(P=0;P<rt.length;P+=1)K.delete(rt[P]);be(s,M.prev,c.next),be(s,F,M),be(s,c,I),V=I,F=c,j-=1,Y=[],rt=[]}else K.delete(R),Ue(R,V,g),be(s,R.prev,R.next),be(s,R,F===null?s.effect.first:F.next),be(s,F,R),F=R;continue}for(Y=[],rt=[];V!==null&&V!==R;)(K??=new Set).add(V),rt.push(V),V=Ve(V.next);if(V===null)continue}(R.f&_e)===0&&Y.push(R),F=R,V=Ve(R.next)}if(s.outrogroups!==null){for(const q of s.outrogroups)q.pending.size===0&&(xr(Rr(q.done)),s.outrogroups?.delete(q));s.outrogroups.size===0&&(s.outrogroups=null)}if(V!==null||K!==void 0){var w=[];if(K!==void 0)for(R of K)(R.f&gr)===0&&w.push(R);for(;V!==null;)(V.f&gr)===0&&V!==s.fallback&&w.push(V),V=Ve(V.next);var d=w.length;if(d>0){var O=_===0?g:null;oi(s,w,O)}}}function li(s,u,g,v,m,_,D,V){var K=(D&On)!==0?(D&Fn)===0?Cn(g,!1,!1):Fr(g):null,F=(D&Dn)!==0?Fr(m):null;return{v:K,i:F,e:Mr(()=>(_(u,K??g,F??m,V),()=>{s.delete(v)}))}}function Ue(s,u,g){if(s.nodes)for(var v=s.nodes.start,m=s.nodes.end,_=u&&(u.f&_e)===0?u.nodes.start:g;v!==null;){var D=Er(v);if(_.before(v),v===m)return;v=D}}function be(s,u,g){u===null?s.effect.first=g:u.next=g,g===null?s.effect.last=u:g.prev=u}function ui(s,u){let g=null,v=se;var m;if(se){g=$e;for(var _=on(document.head);_!==null&&(_.nodeType!==an||_.data!==s);)_=Er(_);if(_===null)Ke(!1);else{var D=Er(_);_.remove(),We(D)}}se||(m=document.head.appendChild(ir()));try{sn(()=>u(m),Bn)}finally{v&&(Ke(!0),We(g))}}const Dr=[...` 	
\r\fÂ \v\uFEFF`];function hi(s,u,g){var v=s==null?"":""+s;if(g){for(var m in g)if(g[m])v=v?v+" "+m:m;else if(v.length)for(var _=m.length,D=0;(D=v.indexOf(m,D))>=0;){var V=D+_;(D===0||Dr.includes(v[D-1]))&&(V===v.length||Dr.includes(v[V]))?v=(D===0?"":v.substring(0,D))+v.substring(V+1):D=V}}return v===""?null:v}function Lr(s,u=!1){var g=u?" !important;":";",v="";for(var m in s){var _=s[m];_!=null&&_!==""&&(v+=" "+m+": "+_+g)}return v}function fi(s,u){if(u){var g="",v,m;return Array.isArray(u)?(v=u[0],m=u[1]):v=u,v&&(g+=Lr(v)),m&&(g+=Lr(m,!0)),g=g.trim(),g===""?null:g}return String(s)}function dr(s,u,g,v,m,_){var D=s.__className;if(se||D!==g||D===void 0){var V=hi(g,v,_);(!se||V!==s.getAttribute("class"))&&(V==null?s.removeAttribute("class"):s.className=V),s.__className=g}else if(_&&m!==_)for(var K in _){var F=!!_[K];(m==null||F!==!!m[K])&&s.classList.toggle(K,F)}return _}function wr(s,u={},g,v){for(var m in g){var _=g[m];u[m]!==_&&(g[m]==null?s.style.removeProperty(m):s.style.setProperty(m,_,v))}}function qr(s,u,g,v){var m=s.__style;if(se||m!==u){var _=fi(u,v);(!se||_!==s.getAttribute("style"))&&(_==null?s.removeAttribute("style"):s.style.cssText=_),s.__style=u}else v&&(Array.isArray(v)?(wr(s,g?.[0],v[0]),wr(s,g?.[1],v[1],"important")):wr(s,g,v));return v}const ci=Symbol("is custom element"),gi=Symbol("is html"),mi=Wn?"link":"LINK";function vi(s){if(se){var u=!1,g=()=>{if(!u){if(u=!0,s.hasAttribute("value")){var v=s.value;Vr(s,"value",null),s.value=v}if(s.hasAttribute("checked")){var m=s.checked;Vr(s,"checked",null),s.checked=m}}};s.__on_r=g,$n(g),Un()}}function Vr(s,u,g,v){var m=pi(s);se&&(m[u]=s.getAttribute(u),u==="src"||u==="srcset"||u==="href"&&s.nodeName===mi)||m[u]!==(m[u]=g)&&(u==="loading"&&(s[An]=g),s.removeAttribute(u))}function pi(s){return s.__attributes??={[ci]:s.nodeName.includes("-"),[gi]:s.namespaceURI===Yn}}function Br(s,u,g=u){var v=new WeakSet;Kn(s,"input",async m=>{var _=m?s.defaultValue:s.value;if(_=yr(s)?br(_):_,g(_),Te!==null&&v.add(Te),await Nr(),_!==(_=u())){var D=s.selectionStart,V=s.selectionEnd,K=s.value.length;if(s.value=_??"",V!==null){var F=s.value.length;D===V&&V===K&&F>K?(s.selectionStart=F,s.selectionEnd=F):(s.selectionStart=D,s.selectionEnd=Math.min(V,F))}}}),(se&&s.defaultValue!==s.value||Qn(u)==null&&s.value)&&(g(yr(s)?br(s.value):s.value),Te!==null&&v.add(Te)),Xn(()=>{var m=u();if(s===document.activeElement){var _=Gn??Te;if(v.has(_))return}yr(s)&&m===br(s.value)||s.type==="date"&&!m&&!s.value||m!==s.value&&(s.value=m??"")})}function yr(s){var u=s.type;return u==="number"||u==="range"}function br(s){return s===""?null:+s}function di(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Ir(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var u=s.default;if(typeof u=="function"){var g=function v(){var m=!1;try{m=this instanceof v}catch{}return m?Reflect.construct(u,arguments,this.constructor):u.apply(this,arguments)};g.prototype=u.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(s).forEach(function(v){var m=Object.getOwnPropertyDescriptor(s,v);Object.defineProperty(g,v,m.get?m:{enumerable:!0,get:function(){return s[v]}})}),g}var _r={},Ct={},Kt={},Ot={},$r;function Xe(){if($r)return Ot;$r=1;var s=Ot&&Ot.__values||function(y){var I=typeof Symbol=="function"&&Symbol.iterator,P=I&&y[I],M=0;if(P)return P.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&M>=y.length&&(y=void 0),{value:y&&y[M++],done:!y}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.reshape2d=Ot.rejectionSample=Ot.max2d=Ot.max=Ot.mean=Ot.sum=Ot.linear=Ot.ones=Ot.zeros=Ot.filled=Ot.range=Ot.empty=Ot.norm=Ot.tauRand=Ot.tauRandInt=void 0;function u(y,I){return Math.floor(I()*y)}Ot.tauRandInt=u;function g(y){return y()}Ot.tauRand=g;function v(y){var I,P,M=0;try{for(var c=s(y),w=c.next();!w.done;w=c.next()){var d=w.value;M+=Math.pow(d,2)}}catch(O){I={error:O}}finally{try{w&&!w.done&&(P=c.return)&&P.call(c)}finally{if(I)throw I.error}}return Math.sqrt(M)}Ot.norm=v;function m(y){for(var I=[],P=0;P<y;P++)I.push(void 0);return I}Ot.empty=m;function _(y){return m(y).map(function(I,P){return P})}Ot.range=_;function D(y,I){return m(y).map(function(){return I})}Ot.filled=D;function V(y){return D(y,0)}Ot.zeros=V;function K(y){return D(y,1)}Ot.ones=K;function F(y,I,P){return m(P).map(function(M,c){return y+c*((I-y)/(P-1))})}Ot.linear=F;function Y(y){return y.reduce(function(I,P){return I+P})}Ot.sum=Y;function rt(y){return Y(y)/y.length}Ot.mean=rt;function E(y){for(var I=0,P=0;P<y.length;P++)I=y[P]>I?y[P]:I;return I}Ot.max=E;function L(y){for(var I=0,P=0;P<y.length;P++)for(var M=0;M<y[P].length;M++)I=y[P][M]>I?y[P][M]:I;return I}Ot.max2d=L;function R(y,I,P){for(var M=V(y),c=0;c<y;c++)for(var w=!0;w;){for(var d=u(I,P),O=!1,q=0;q<c;q++)if(d===M[q]){O=!0;break}O||(w=!1),M[c]=d}return M}Ot.rejectionSample=R;function j(y,I,P){var M=[],c=0;if(y.length!==I*P)throw new Error("Array dimensions must match input length.");for(var w=0;w<I;w++){for(var d=[],O=0;O<P;O++)d.push(y[c]),c+=1;M.push(d)}return M}return Ot.reshape2d=j,Ot}var Ur;function hn(){if(Ur)return Kt;Ur=1;var s=Kt&&Kt.__createBinding||(Object.create?(function(E,L,R,j){j===void 0&&(j=R),Object.defineProperty(E,j,{enumerable:!0,get:function(){return L[R]}})}):(function(E,L,R,j){j===void 0&&(j=R),E[j]=L[R]})),u=Kt&&Kt.__setModuleDefault||(Object.create?(function(E,L){Object.defineProperty(E,"default",{enumerable:!0,value:L})}):function(E,L){E.default=L}),g=Kt&&Kt.__importStar||function(E){if(E&&E.__esModule)return E;var L={};if(E!=null)for(var R in E)R!=="default"&&Object.hasOwnProperty.call(E,R)&&s(L,E,R);return u(L,E),L};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.smallestFlagged=Kt.deheapSort=Kt.buildCandidates=Kt.uncheckedHeapPush=Kt.heapPush=Kt.rejectionSample=Kt.makeHeap=void 0;var v=g(Xe());function m(E,L){var R=function(y){return v.empty(E).map(function(){return v.filled(L,y)})},j=[];return j.push(R(-1)),j.push(R(1/0)),j.push(R(0)),j}Kt.makeHeap=m;function _(E,L,R){for(var j=v.zeros(E),y=0;y<E;y++){for(var I=!0,P=0;I;){P=v.tauRandInt(L,R);for(var M=!1,c=0;c<y;c++)if(P===j[c]){M=!0;break}M||(I=!1)}j[y]=P}return j}Kt.rejectionSample=_;function D(E,L,R,j,y){L=Math.floor(L);var I=E[0][L],P=E[1][L];if(E[2][L],R>=P[0])return 0;for(var M=0;M<I.length;M++)if(j===I[M])return 0;return V(E,L,R,j,y)}Kt.heapPush=D;function V(E,L,R,j,y){var I=E[0][L],P=E[1][L],M=E[2][L];if(R>=P[0])return 0;P[0]=R,I[0]=j,M[0]=y;for(var c=0,w=0;;){var d=2*c+1,O=d+1,q=E[0][0].length;if(d>=q)break;if(O>=q)if(P[d]>R)w=d;else break;else if(P[d]>=P[O])if(R<P[d])w=d;else break;else if(R<P[O])w=O;else break;P[c]=P[w],I[c]=I[w],M[c]=M[w],c=w}return P[c]=R,I[c]=j,M[c]=y,1}Kt.uncheckedHeapPush=V;function K(E,L,R,j,y){for(var I=m(L,j),P=0;P<L;P++)for(var M=0;M<R;M++)if(!(E[0][P][M]<0)){var c=E[0][P][M],w=E[2][P][M],d=v.tauRand(y);D(I,P,d,c,w),D(I,c,d,P,w),E[2][P][M]=0}return I}Kt.buildCandidates=K;function F(E){for(var L=E[0],R=E[1],j=0;j<L.length;j++)for(var y=L[j],I=R[j],P=0;P<y.length-1;P++){var M=y.length-P-1,c=I.length-P-1,w=y[0];y[0]=y[M],y[M]=w;var d=I[0];I[0]=I[c],I[c]=d,Y(I,y,c,0)}return{indices:L,weights:R}}Kt.deheapSort=F;function Y(E,L,R,j){for(;j*2+1<R;){var y=j*2+1,I=y+1,P=j;if(E[P]<E[y]&&(P=y),I<R&&E[P]<E[I]&&(P=I),P===j)break;var M=E[j];E[j]=E[P],E[P]=M;var c=L[j];L[j]=L[P],L[P]=c,j=P}}function rt(E,L){for(var R=E[0][L],j=E[1][L],y=E[2][L],I=1/0,P=-1,M=0;M>R.length;M++)y[M]===1&&j[M]<I&&(I=j[M],P=M);return P>=0?(y[P]=0,Math.floor(R[P])):-1}return Kt.smallestFlagged=rt,Kt}var Ft={},Ar;function fn(){if(Ar)return Ft;Ar=1;var s=Ft&&Ft.__createBinding||(Object.create?(function(c,w,d,O){O===void 0&&(O=d),Object.defineProperty(c,O,{enumerable:!0,get:function(){return w[d]}})}):(function(c,w,d,O){O===void 0&&(O=d),c[O]=w[d]})),u=Ft&&Ft.__setModuleDefault||(Object.create?(function(c,w){Object.defineProperty(c,"default",{enumerable:!0,value:w})}):function(c,w){c.default=w}),g=Ft&&Ft.__importStar||function(c){if(c&&c.__esModule)return c;var w={};if(c!=null)for(var d in c)d!=="default"&&Object.hasOwnProperty.call(c,d)&&s(w,c,d);return u(w,c),w},v=Ft&&Ft.__read||function(c,w){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var O=d.call(c),q,X=[],C;try{for(;(w===void 0||w-- >0)&&!(q=O.next()).done;)X.push(q.value)}catch(S){C={error:S}}finally{try{q&&!q.done&&(d=O.return)&&d.call(O)}finally{if(C)throw C.error}}return X},m=Ft&&Ft.__values||function(c){var w=typeof Symbol=="function"&&Symbol.iterator,d=w&&c[w],O=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&O>=c.length&&(c=void 0),{value:c&&c[O++],done:!c}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},_;Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.getCSR=Ft.normalize=Ft.eliminateZeros=Ft.multiplyScalar=Ft.maximum=Ft.subtract=Ft.add=Ft.pairwiseMultiply=Ft.identity=Ft.transpose=Ft.SparseMatrix=void 0;var D=g(Xe()),V=(function(){function c(w,d,O,q){if(this.entries=new Map,this.nRows=0,this.nCols=0,w.length!==d.length||w.length!==O.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=q[0],this.nCols=q[1];for(var X=0;X<O.length;X++){var C=w[X],S=d[X];this.checkDims(C,S);var N=this.makeKey(C,S);this.entries.set(N,{value:O[X],row:C,col:S})}}return c.prototype.makeKey=function(w,d){return w+":"+d},c.prototype.checkDims=function(w,d){var O=w<this.nRows&&d<this.nCols;if(!O)throw new Error("row and/or col specified outside of matrix dimensions")},c.prototype.set=function(w,d,O){this.checkDims(w,d);var q=this.makeKey(w,d);this.entries.has(q)?this.entries.get(q).value=O:this.entries.set(q,{value:O,row:w,col:d})},c.prototype.get=function(w,d,O){O===void 0&&(O=0),this.checkDims(w,d);var q=this.makeKey(w,d);return this.entries.has(q)?this.entries.get(q).value:O},c.prototype.getAll=function(w){w===void 0&&(w=!0);var d=[];return this.entries.forEach(function(O){d.push(O)}),w&&d.sort(function(O,q){return O.row===q.row?O.col-q.col:O.row-q.row}),d},c.prototype.getDims=function(){return[this.nRows,this.nCols]},c.prototype.getRows=function(){return Array.from(this.entries,function(w){var d=v(w,2);d[0];var O=d[1];return O.row})},c.prototype.getCols=function(){return Array.from(this.entries,function(w){var d=v(w,2);d[0];var O=d[1];return O.col})},c.prototype.getValues=function(){return Array.from(this.entries,function(w){var d=v(w,2);d[0];var O=d[1];return O.value})},c.prototype.forEach=function(w){this.entries.forEach(function(d){return w(d.value,d.row,d.col)})},c.prototype.map=function(w){var d=[];this.entries.forEach(function(q){d.push(w(q.value,q.row,q.col))});var O=[this.nRows,this.nCols];return new c(this.getRows(),this.getCols(),d,O)},c.prototype.toArray=function(){var w=this,d=D.empty(this.nRows),O=d.map(function(){return D.zeros(w.nCols)});return this.entries.forEach(function(q){O[q.row][q.col]=q.value}),O},c})();Ft.SparseMatrix=V;function K(c){var w=[],d=[],O=[];c.forEach(function(X,C,S){w.push(C),d.push(S),O.push(X)});var q=[c.nCols,c.nRows];return new V(d,w,O,q)}Ft.transpose=K;function F(c){for(var w=v(c,1),d=w[0],O=new V([],[],[],c),q=0;q<d;q++)O.set(q,q,1);return O}Ft.identity=F;function Y(c,w){return P(c,w,function(d,O){return d*O})}Ft.pairwiseMultiply=Y;function rt(c,w){return P(c,w,function(d,O){return d+O})}Ft.add=rt;function E(c,w){return P(c,w,function(d,O){return d-O})}Ft.subtract=E;function L(c,w){return P(c,w,function(d,O){return d>O?d:O})}Ft.maximum=L;function R(c,w){return c.map(function(d){return d*w})}Ft.multiplyScalar=R;function j(c){for(var w=new Set,d=c.getValues(),O=c.getRows(),q=c.getCols(),X=0;X<d.length;X++)d[X]===0&&w.add(X);var C=function(G,B){return!w.has(B)},S=d.filter(C),N=O.filter(C),x=q.filter(C);return new V(N,x,S,c.getDims())}Ft.eliminateZeros=j;function y(c,w){var d,O;w===void 0&&(w="l2");var q=I[w],X=new Map;c.forEach(function(B,Q,at){var mt=X.get(Q)||[];mt.push(at),X.set(Q,mt)});var C=new V([],[],[],c.getDims()),S=function(B){for(var Q=X.get(B).sort(),at=Q.map(function(ct){return c.get(B,ct)}),mt=q(at),tt=0;tt<mt.length;tt++)C.set(B,Q[tt],mt[tt])};try{for(var N=m(X.keys()),x=N.next();!x.done;x=N.next()){var G=x.value;S(G)}}catch(B){d={error:B}}finally{try{x&&!x.done&&(O=N.return)&&O.call(N)}finally{if(d)throw d.error}}return C}Ft.normalize=y;var I=(_={},_.max=function(c){for(var w=-1/0,d=0;d<c.length;d++)w=c[d]>w?c[d]:w;return c.map(function(O){return O/w})},_.l1=function(c){for(var w=0,d=0;d<c.length;d++)w+=c[d];return c.map(function(O){return O/w})},_.l2=function(c){for(var w=0,d=0;d<c.length;d++)w+=Math.pow(c[d],2);return c.map(function(O){return Math.sqrt(Math.pow(O,2)/w)})},_);function P(c,w,d){for(var O=new Set,q=[],X=[],C=[],S=function(It,zt){q.push(It),X.push(zt);var H=d(c.get(It,zt),w.get(It,zt));C.push(H)},N=c.getValues(),x=c.getRows(),G=c.getCols(),B=0;B<N.length;B++){var Q=x[B],at=G[B],mt=Q+":"+at;O.add(mt),S(Q,at)}for(var tt=w.getValues(),ct=w.getRows(),bt=w.getCols(),B=0;B<tt.length;B++){var Q=ct[B],at=bt[B],mt=Q+":"+at;O.has(mt)||S(Q,at)}var st=[c.nRows,c.nCols];return new V(q,X,C,st)}function M(c){var w=[];c.forEach(function(B,Q,at){w.push({value:B,row:Q,col:at})}),w.sort(function(B,Q){return B.row===Q.row?B.col-Q.col:B.row-Q.row});for(var d=[],O=[],q=[],X=-1,C=0;C<w.length;C++){var S=w[C],N=S.row,x=S.col,G=S.value;N!==X&&(X=N,q.push(C)),d.push(x),O.push(G)}return{indices:d,values:O,indptr:q}}return Ft.getCSR=M,Ft}var te={},Qt={},Yr;function cn(){if(Yr)return Qt;Yr=1;var s=Qt&&Qt.__createBinding||(Object.create?(function(M,c,w,d){d===void 0&&(d=w),Object.defineProperty(M,d,{enumerable:!0,get:function(){return c[w]}})}):(function(M,c,w,d){d===void 0&&(d=w),M[d]=c[w]})),u=Qt&&Qt.__setModuleDefault||(Object.create?(function(M,c){Object.defineProperty(M,"default",{enumerable:!0,value:c})}):function(M,c){M.default=c}),g=Qt&&Qt.__importStar||function(M){if(M&&M.__esModule)return M;var c={};if(M!=null)for(var w in M)w!=="default"&&Object.hasOwnProperty.call(M,w)&&s(c,M,w);return u(c,M),c},v=Qt&&Qt.__read||function(M,c){var w=typeof Symbol=="function"&&M[Symbol.iterator];if(!w)return M;var d=w.call(M),O,q=[],X;try{for(;(c===void 0||c-- >0)&&!(O=d.next()).done;)q.push(O.value)}catch(C){X={error:C}}finally{try{O&&!O.done&&(w=d.return)&&w.call(d)}finally{if(X)throw X.error}}return q},m=Qt&&Qt.__spread||function(){for(var M=[],c=0;c<arguments.length;c++)M=M.concat(v(arguments[c]));return M},_=Qt&&Qt.__values||function(M){var c=typeof Symbol=="function"&&Symbol.iterator,w=c&&M[c],d=0;if(w)return w.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&d>=M.length&&(M=void 0),{value:M&&M[d++],done:!M}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.searchFlatTree=Qt.makeLeafArray=Qt.makeForest=Qt.FlatTree=void 0;var D=g(Xe()),V=(function(){function M(c,w,d,O){this.hyperplanes=c,this.offsets=w,this.children=d,this.indices=O}return M})();Qt.FlatTree=V;function K(M,c,w,d){var O=Math.max(10,c),q=D.range(w).map(function(C,S){return F(M,O,S,d)}),X=q.map(function(C){return E(C,O)});return X}Qt.makeForest=K;function F(M,c,w,d){c===void 0&&(c=30);var O=D.range(M.length),q=Y(M,O,c,w,d);return q}function Y(M,c,w,d,O){if(w===void 0&&(w=30),c.length>w){var q=rt(M,c,O),X=q.indicesLeft,C=q.indicesRight,S=q.hyperplane,N=q.offset,x=Y(M,X,w,d+1,O),G=Y(M,C,w,d+1,O),B={leftChild:x,rightChild:G,isLeaf:!1,hyperplane:S,offset:N};return B}else{var B={indices:c,isLeaf:!0};return B}}function rt(M,c,w){var d=M[0].length,O=D.tauRandInt(c.length,w),q=D.tauRandInt(c.length,w);q+=O===q?1:0,q=q%c.length;for(var X=c[O],C=c[q],S=0,N=D.zeros(d),x=0;x<N.length;x++)N[x]=M[X][x]-M[C][x],S-=N[x]*(M[X][x]+M[C][x])/2;for(var G=0,B=0,Q=D.zeros(c.length),x=0;x<c.length;x++){for(var at=S,mt=0;mt<d;mt++)at+=N[mt]*M[c[x]][mt];at===0?(Q[x]=D.tauRandInt(2,w),Q[x]===0?G+=1:B+=1):at>0?(Q[x]=0,G+=1):(Q[x]=1,B+=1)}var tt=D.zeros(G),ct=D.zeros(B);G=0,B=0;for(var x=0;x<Q.length;x++)Q[x]===0?(tt[G]=c[x],G+=1):(ct[B]=c[x],B+=1);return{indicesLeft:tt,indicesRight:ct,hyperplane:N,offset:S}}function E(M,c){var w=R(M),d=j(M),O=D.range(w).map(function(){return D.zeros(M.hyperplane?M.hyperplane.length:0)}),q=D.zeros(w),X=D.range(w).map(function(){return[-1,-1]}),C=D.range(d).map(function(){return D.range(c).map(function(){return-1})});return L(M,O,q,X,C,0,0),new V(O,q,X,C)}function L(M,c,w,d,O,q,X){var C;if(M.isLeaf)return d[q][0]=-X,(C=O[X]).splice.apply(C,m([0,M.indices.length],M.indices)),X+=1,{nodeNum:q,leafNum:X};c[q]=M.hyperplane,w[q]=M.offset,d[q][0]=q+1;var S=q,N=L(M.leftChild,c,w,d,O,q+1,X);return q=N.nodeNum,X=N.leafNum,d[S][1]=q+1,N=L(M.rightChild,c,w,d,O,q+1,X),{nodeNum:N.nodeNum,leafNum:N.leafNum}}function R(M){return M.isLeaf?1:1+R(M.leftChild)+R(M.rightChild)}function j(M){return M.isLeaf?1:j(M.leftChild)+j(M.rightChild)}function y(M){var c,w;if(M.length>0){var d=[];try{for(var O=_(M),q=O.next();!q.done;q=O.next()){var X=q.value;d.push.apply(d,m(X.indices))}}catch(C){c={error:C}}finally{try{q&&!q.done&&(w=O.return)&&w.call(O)}finally{if(c)throw c.error}}return d}else return[[-1]]}Qt.makeLeafArray=y;function I(M,c,w,d){for(var O=c,q=0;q<w.length;q++)O+=M[q]*w[q];if(O===0){var X=D.tauRandInt(2,d);return X}else return O>0?0:1}function P(M,c,w){for(var d=0;c.children[d][0]>0;){var O=I(c.hyperplanes[d],c.offsets[d],M,w);O===0?d=c.children[d][0]:d=c.children[d][1]}var q=-1*c.children[d][0];return c.indices[q]}return Qt.searchFlatTree=P,Qt}var Wr;function wi(){if(Wr)return te;Wr=1;var s=te&&te.__createBinding||(Object.create?(function(E,L,R,j){j===void 0&&(j=R),Object.defineProperty(E,j,{enumerable:!0,get:function(){return L[R]}})}):(function(E,L,R,j){j===void 0&&(j=R),E[j]=L[R]})),u=te&&te.__setModuleDefault||(Object.create?(function(E,L){Object.defineProperty(E,"default",{enumerable:!0,value:L})}):function(E,L){E.default=L}),g=te&&te.__importStar||function(E){if(E&&E.__esModule)return E;var L={};if(E!=null)for(var R in E)R!=="default"&&Object.hasOwnProperty.call(E,R)&&s(L,E,R);return u(L,E),L},v=te&&te.__values||function(E){var L=typeof Symbol=="function"&&Symbol.iterator,R=L&&E[L],j=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&j>=E.length&&(E=void 0),{value:E&&E[j++],done:!E}}};throw new TypeError(L?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(te,"__esModule",{value:!0}),te.initializeSearch=te.makeInitializedNNSearch=te.makeInitializations=te.makeNNDescent=void 0;var m=g(hn()),_=g(fn()),D=g(cn()),V=g(Xe());function K(E,L){return function(j,y,I,P,M,c,w,d){P===void 0&&(P=10),M===void 0&&(M=50),c===void 0&&(c=.001),w===void 0&&(w=.5),d===void 0&&(d=!0);for(var O=j.length,q=m.makeHeap(j.length,I),X=0;X<j.length;X++)for(var C=m.rejectionSample(I,j.length,L),S=0;S<C.length;S++){var N=E(j[X],j[C[S]]);m.heapPush(q,X,N,C[S],1),m.heapPush(q,C[S],N,X,1)}if(d)for(var x=0;x<y.length;x++)for(var X=0;X<y[x].length&&!(y[x][X]<0);X++)for(var S=X+1;S<y[x].length&&!(y[x][S]<0);S++){var N=E(j[y[x][X]],j[y[x][S]]);m.heapPush(q,y[x][X],N,y[x][S],1),m.heapPush(q,y[x][S],N,y[x][X],1)}for(var x=0;x<P;x++){for(var G=m.buildCandidates(q,O,I,M,L),B=0,X=0;X<O;X++)for(var S=0;S<M;S++){var Q=Math.floor(G[0][X][S]);if(!(Q<0||V.tauRand(L)<w))for(var at=0;at<M;at++){var mt=Math.floor(G[0][X][at]),tt=G[2][X][S],ct=G[2][X][at];if(!(mt<0||!tt&&!ct)){var N=E(j[Q],j[mt]);B+=m.heapPush(q,Q,N,mt,1),B+=m.heapPush(q,mt,N,Q,1)}}}if(B<=c*I*j.length)break}var bt=m.deheapSort(q);return bt}}te.makeNNDescent=K;function F(E){function L(j,y,I,P,M){for(var c=0;c<I.length;c++)for(var w=V.rejectionSample(j,y.length,M),d=0;d<w.length;d++)if(!(w[d]<0)){var O=E(y[w[d]],I[c]);m.heapPush(P,c,O,w[d],1)}}function R(j,y,I,P,M){for(var c=0;c<I.length;c++)for(var w=D.searchFlatTree(I[c],j,M),d=0;d<w.length;d++){if(w[d]<0)return;var O=E(y[w[d]],I[c]);m.heapPush(P,c,O,w[d],1)}}return{initFromRandom:L,initFromTree:R}}te.makeInitializations=F;function Y(E){return function(R,j,y,I){for(var P,M,c=_.getCSR(j),w=c.indices,d=c.indptr,O=0;O<I.length;O++)for(var q=new Set(y[0][O]);;){var X=m.smallestFlagged(y,O);if(X===-1)break;var C=w.slice(d[X],d[X+1]);try{for(var S=(P=void 0,v(C)),N=S.next();!N.done;N=S.next()){var x=N.value;if(!(x===X||x===-1||q.has(x))){var G=E(R[x],I[O]);m.uncheckedHeapPush(y,O,G,x,1),q.add(x)}}}catch(B){P={error:B}}finally{try{N&&!N.done&&(M=S.return)&&M.call(S)}finally{if(P)throw P.error}}}return y}}te.makeInitializedNNSearch=Y;function rt(E,L,R,j,y,I,P){var M,c,w=m.makeHeap(R.length,j);if(y(j,L,R,w,P),E)try{for(var d=v(E),O=d.next();!O.done;O=d.next()){var q=O.value;I(q,L,R,w,P)}}catch(X){M={error:X}}finally{try{O&&!O.done&&(c=d.return)&&c.call(d)}finally{if(M)throw M.error}}return w}return te.initializeSearch=rt,te}const yi=Object.prototype.toString;function Sr(s){return yi.call(s).endsWith("Array]")}function Kr(s,u,g){let v=0;const m=g(u);for(let _=0;_<s.x.length;_++)v+=Math.abs(s.y[_]-m(s.x[_]));return v}var Tt={};const bi=Object.prototype.toString;function _i(s){const u=bi.call(s);return u.endsWith("Array]")&&!u.includes("Big")}const Si=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:_i},Symbol.toStringTag,{value:"Module"})),Mi=Ir(Si),Ei=Object.prototype.toString;function Qr(s){const u=Ei.call(s);return u.endsWith("Array]")&&!u.includes("Big")}const Ni=Object.prototype.toString;function xi(s){const u=Ni.call(s);return u.endsWith("Array]")&&!u.includes("Big")}function ji(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!xi(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");var g=u.fromIndex,v=g===void 0?0:g,m=u.toIndex,_=m===void 0?s.length:m;if(v<0||v>=s.length||!Number.isInteger(v))throw new Error("fromIndex must be a positive integer smaller than length");if(_<=v||_>s.length||!Number.isInteger(_))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var D=s[v],V=v+1;V<_;V++)s[V]>D&&(D=s[V]);return D}const ki=Object.prototype.toString;function Ri(s){const u=ki.call(s);return u.endsWith("Array]")&&!u.includes("Big")}function Ii(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ri(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");var g=u.fromIndex,v=g===void 0?0:g,m=u.toIndex,_=m===void 0?s.length:m;if(v<0||v>=s.length||!Number.isInteger(v))throw new Error("fromIndex must be a positive integer smaller than length");if(_<=v||_>s.length||!Number.isInteger(_))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var D=s[v],V=v+1;V<_;V++)s[V]<D&&(D=s[V]);return D}function Ti(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Qr(s)){if(s.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var g;if(u.output!==void 0){if(!Qr(u.output))throw new TypeError("output option must be an array if specified");g=u.output}else g=new Array(s.length);var v=Ii(s),m=ji(s);if(v===m)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var _=u.min,D=_===void 0?u.autoMinMax?v:0:_,V=u.max,K=V===void 0?u.autoMinMax?m:1:V;if(D>=K)throw new RangeError("min option must be smaller than max option");for(var F=(K-D)/(m-v),Y=0;Y<s.length;Y++)g[Y]=(s[Y]-v)*F+D;return g}const zi=Object.freeze(Object.defineProperty({__proto__:null,default:Ti},Symbol.toStringTag,{value:"Module"})),Pi=Ir(zi);var Xr;function Oi(){if(Xr)return Tt;Xr=1,Object.defineProperty(Tt,"__esModule",{value:!0});var s=Mi,u=Pi;const g=" ".repeat(2),v=" ".repeat(4);function m(){return _(this)}function _(o,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:n=8,padMinus:i="auto"}=e;return`${o.constructor.name} {
${g}[
${v}${D(o,r,t,n,i)}
${g}]
${g}rows: ${o.rows}
${g}columns: ${o.columns}
}`}function D(o,e,r,t,n){const{rows:i,columns:a}=o,l=Math.min(i,e),h=Math.min(a,r),f=[];if(n==="auto"){n=!1;t:for(let z=0;z<l;z++)for(let p=0;p<h;p++)if(o.get(z,p)<0){n=!0;break t}}for(let z=0;z<l;z++){let p=[];for(let U=0;U<h;U++)p.push(V(o.get(z,U),t,n));f.push(`${p.join(" ")}`)}return h!==a&&(f[f.length-1]+=` ... ${a-r} more columns`),l!==i&&f.push(`... ${i-e} more rows`),f.join(`
${v}`)}function V(o,e,r){return(o>=0&&r?` ${K(o,e-1)}`:K(o,e)).padEnd(e)}function K(o,e){let r=o.toString();if(r.length<=e)return r;let t=o.toFixed(e);if(t.length>e&&(t=o.toFixed(Math.max(0,e-(t.length-e)))),t.length<=e&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let n=o.toExponential(e);return n.length>e&&(n=o.toExponential(Math.max(0,e-(n.length-e)))),n.slice(0)}function F(o,e){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)+t);return this},o.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)+t.get(n,i));return this},o.add=function(t,n){return new e(t).add(n)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)-t);return this},o.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)-t.get(n,i));return this},o.sub=function(t,n){return new e(t).sub(n)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)*t);return this},o.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)*t.get(n,i));return this},o.mul=function(t,n){return new e(t).mul(n)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)/t);return this},o.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)/t.get(n,i));return this},o.div=function(t,n){return new e(t).div(n)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)%t);return this},o.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)%t.get(n,i));return this},o.mod=function(t,n){return new e(t).mod(n)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)&t);return this},o.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)&t.get(n,i));return this},o.and=function(t,n){return new e(t).and(n)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)|t);return this},o.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)|t.get(n,i));return this},o.or=function(t,n){return new e(t).or(n)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)^t);return this},o.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)^t.get(n,i));return this},o.xor=function(t,n){return new e(t).xor(n)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)<<t);return this},o.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)<<t.get(n,i));return this},o.leftShift=function(t,n){return new e(t).leftShift(n)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>t.get(n,i));return this},o.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>>t.get(n,i));return this},o.rightShift=function(t,n){return new e(t).rightShift(n)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},o.not=function(t){return new e(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},o.abs=function(t){return new e(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},o.acos=function(t){return new e(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},o.acosh=function(t){return new e(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},o.asin=function(t){return new e(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},o.asinh=function(t){return new e(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},o.atan=function(t){return new e(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},o.atanh=function(t){return new e(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},o.cbrt=function(t){return new e(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},o.ceil=function(t){return new e(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},o.clz32=function(t){return new e(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},o.cos=function(t){return new e(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},o.cosh=function(t){return new e(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},o.exp=function(t){return new e(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},o.expm1=function(t){return new e(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},o.floor=function(t){return new e(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},o.fround=function(t){return new e(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},o.log=function(t){return new e(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},o.log1p=function(t){return new e(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},o.log10=function(t){return new e(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},o.log2=function(t){return new e(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},o.round=function(t){return new e(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},o.sign=function(t){return new e(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},o.sin=function(t){return new e(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},o.sinh=function(t){return new e(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},o.sqrt=function(t){return new e(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},o.tan=function(t){return new e(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},o.tanh=function(t){return new e(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},o.trunc=function(t){return new e(t).trunc()},o.pow=function(t,n){return new e(t).pow(n)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)**t);return this},o.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)**t.get(n,i));return this}}function Y(o,e,r){let t=r?o.rows:o.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function rt(o,e,r){let t=r?o.columns:o.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function E(o,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function L(o,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function R(o,e){if(!s.isAnyArray(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=o.rows)throw new RangeError("row indices are out of range")}function j(o,e){if(!s.isAnyArray(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=o.columns)throw new RangeError("column indices are out of range")}function y(o,e,r,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(P("startRow",e),P("endRow",r),P("startColumn",t),P("endColumn",n),e>r||t>n||e<0||e>=o.rows||r<0||r>=o.rows||t<0||t>=o.columns||n<0||n>=o.columns)throw new RangeError("Submatrix indices are out of range")}function I(o,e=0){let r=[];for(let t=0;t<o;t++)r.push(e);return r}function P(o,e){if(typeof e!="number")throw new TypeError(`${o} must be a number`)}function M(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function c(o){let e=I(o.rows);for(let r=0;r<o.rows;++r)for(let t=0;t<o.columns;++t)e[r]+=o.get(r,t);return e}function w(o){let e=I(o.columns);for(let r=0;r<o.rows;++r)for(let t=0;t<o.columns;++t)e[t]+=o.get(r,t);return e}function d(o){let e=0;for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)e+=o.get(r,t);return e}function O(o){let e=I(o.rows,1);for(let r=0;r<o.rows;++r)for(let t=0;t<o.columns;++t)e[r]*=o.get(r,t);return e}function q(o){let e=I(o.columns,1);for(let r=0;r<o.rows;++r)for(let t=0;t<o.columns;++t)e[t]*=o.get(r,t);return e}function X(o){let e=1;for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)e*=o.get(r,t);return e}function C(o,e,r){const t=o.rows,n=o.columns,i=[];for(let a=0;a<t;a++){let l=0,h=0,f=0;for(let z=0;z<n;z++)f=o.get(a,z)-r[a],l+=f,h+=f*f;e?i.push((h-l*l/n)/(n-1)):i.push((h-l*l/n)/n)}return i}function S(o,e,r){const t=o.rows,n=o.columns,i=[];for(let a=0;a<n;a++){let l=0,h=0,f=0;for(let z=0;z<t;z++)f=o.get(z,a)-r[a],l+=f,h+=f*f;e?i.push((h-l*l/t)/(t-1)):i.push((h-l*l/t)/t)}return i}function N(o,e,r){const t=o.rows,n=o.columns,i=t*n;let a=0,l=0,h=0;for(let f=0;f<t;f++)for(let z=0;z<n;z++)h=o.get(f,z)-r,a+=h,l+=h*h;return e?(l-a*a/i)/(i-1):(l-a*a/i)/i}function x(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)-e[r])}function G(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)-e[t])}function B(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)-e)}function Q(o){const e=[];for(let r=0;r<o.rows;r++){let t=0;for(let n=0;n<o.columns;n++)t+=o.get(r,n)**2/(o.columns-1);e.push(Math.sqrt(t))}return e}function at(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)/e[r])}function mt(o){const e=[];for(let r=0;r<o.columns;r++){let t=0;for(let n=0;n<o.rows;n++)t+=o.get(n,r)**2/(o.rows-1);e.push(Math.sqrt(t))}return e}function tt(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)/e[t])}function ct(o){const e=o.size-1;let r=0;for(let t=0;t<o.columns;t++)for(let n=0;n<o.rows;n++)r+=o.get(n,t)**2/e;return Math.sqrt(r)}function bt(o,e){for(let r=0;r<o.rows;r++)for(let t=0;t<o.columns;t++)o.set(r,t,o.get(r,t)/e)}class st{static from1DArray(e,r,t){if(e*r!==t.length)throw new RangeError("data length does not match given dimensions");let i=new H(e,r);for(let a=0;a<e;a++)for(let l=0;l<r;l++)i.set(a,l,t[a*r+l]);return i}static rowVector(e){let r=new H(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new H(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new H(e,r)}static ones(e,r){return new H(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let i=new H(e,r);for(let a=0;a<e;a++)for(let l=0;l<r;l++)i.set(a,l,n());return i}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:i=1e3,random:a=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(n>=i)throw new RangeError("min must be smaller than max");let l=i-n,h=new H(e,r);for(let f=0;f<e;f++)for(let z=0;z<r;z++){let p=n+Math.round(a()*l);h.set(f,z,p)}return h}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let n=Math.min(e,r),i=this.zeros(e,r);for(let a=0;a<n;a++)i.set(a,a,t);return i}static diag(e,r,t){let n=e.length;r===void 0&&(r=n),t===void 0&&(t=r);let i=Math.min(n,r,t),a=this.zeros(r,t);for(let l=0;l<i;l++)a.set(l,l,e[l]);return a}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,i=new H(t,n);for(let a=0;a<t;a++)for(let l=0;l<n;l++)i.set(a,l,Math.min(e.get(a,l),r.get(a,l)));return i}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,i=new this(t,n);for(let a=0;a<t;a++)for(let l=0;l<n;l++)i.set(a,l,Math.max(e.get(a,l),r.get(a,l)));return i}static checkMatrix(e){return st.isMatrix(e)?e:new H(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,r=0,t=-1,n=!0,i=!1;for(;e<this.rows&&n;){for(r=0,i=!1;r<this.columns&&i===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(i=!0,t=r):(n=!1,i=!0);e++}return n}isReducedEchelonForm(){let e=0,r=0,t=-1,n=!0,i=!1;for(;e<this.rows&&n;){for(r=0,i=!1;r<this.columns&&i===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(i=!0,t=r):(n=!1,i=!0);for(let a=r+1;a<this.rows;a++)this.get(e,a)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let n=r;for(let i=r;i<e.rows;i++)e.get(i,t)>e.get(n,t)&&(n=i);if(e.get(n,t)===0)t++;else{e.swapRows(r,n);let i=e.get(r,t);for(let a=t;a<e.columns;a++)e.set(r,a,e.get(r,a)/i);for(let a=r+1;a<e.rows;a++){let l=e.get(a,t)/e.get(r,t);e.set(a,t,0);for(let h=t+1;h<e.columns;h++)e.set(a,h,e.get(a,h)-e.get(r,h)*l)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,n=t-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let i=0,a=!1;for(;i<t&&a===!1;)e.get(n,i)===1?a=!0:i++;for(let l=0;l<n;l++){let h=e.get(l,i);for(let f=i;f<r;f++){let z=e.get(l,f)-h*e.get(n,f);e.set(l,f,z)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new H(this.rows*r,this.columns*t);for(let i=0;i<r;i++)for(let a=0;a<t;a++)n.setSubMatrix(this,this.rows*i,this.columns*a);return n}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){Y(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return H.rowVector(this.getRow(e))}setRow(e,r){Y(this,e),r=E(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){Y(this,e),Y(this,r);for(let t=0;t<this.columns;t++){let n=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,n)}return this}getColumn(e){rt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return H.columnVector(this.getColumn(e))}setColumn(e,r){rt(this,e),r=L(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){rt(this,e),rt(this,r);for(let t=0;t<this.rows;t++){let n=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,n)}return this}addRowVector(e){e=E(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=E(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=E(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=E(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=L(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=L(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=L(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=L(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){Y(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){rt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r[t]&&(r[t]=this.get(t,n));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r[n]&&(r[n]=this.get(t,n));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n));return r}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){M(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r[t]&&(r[t]=this.get(t,n));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r[n]&&(r[n]=this.get(t,n));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n));return r}default:throw new Error(`invalid option: ${e}`)}}minIndex(){M(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}maxRow(e){if(Y(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){Y(this,e),M(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n),t[1]=n);return t}minRow(e){if(Y(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){Y(this,e),M(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n),t[1]=n);return t}maxColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){rt(this,e),M(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e),t[0]=n);return t}minColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){rt(this,e),M(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e),t[0]=n);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){st.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<r.length;n++)t+=r[n]*e[n];return t}mmul(e){e=H.checkMatrix(e);let r=this.rows,t=this.columns,n=e.columns,i=new H(r,n),a=new Float64Array(t);for(let l=0;l<n;l++){for(let h=0;h<t;h++)a[h]=e.get(h,l);for(let h=0;h<r;h++){let f=0;for(let z=0;z<t;z++)f+=this.get(h,z)*a[z];i.set(h,l,f)}}return i}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let r=H.eye(this.rows),t=this;for(let n=e;n>=1;n/=2)(n&1)!==0&&(r=r.mmul(t)),t=t.mmul(t);return r}strassen2x2(e){e=H.checkMatrix(e);let r=new H(2,2);const t=this.get(0,0),n=e.get(0,0),i=this.get(0,1),a=e.get(0,1),l=this.get(1,0),h=e.get(1,0),f=this.get(1,1),z=e.get(1,1),p=(t+f)*(n+z),U=(l+f)*n,it=t*(a-z),$=f*(h-n),W=(t+i)*z,lt=(l-t)*(n+a),b=(i-f)*(h+z),nt=p+$-W+b,ht=it+W,_t=U+$,Et=p-U+it+lt;return r.set(0,0,nt),r.set(0,1,ht),r.set(1,0,_t),r.set(1,1,Et),r}strassen3x3(e){e=H.checkMatrix(e);let r=new H(3,3);const t=this.get(0,0),n=this.get(0,1),i=this.get(0,2),a=this.get(1,0),l=this.get(1,1),h=this.get(1,2),f=this.get(2,0),z=this.get(2,1),p=this.get(2,2),U=e.get(0,0),it=e.get(0,1),$=e.get(0,2),W=e.get(1,0),lt=e.get(1,1),b=e.get(1,2),nt=e.get(2,0),ht=e.get(2,1),_t=e.get(2,2),Et=(t+n+i-a-l-z-p)*lt,Ut=(t-a)*(-it+lt),wt=l*(-U+it+W-lt-b-nt+_t),yt=(-t+a+l)*(U-it+lt),Vt=(a+l)*(-U+it),k=t*U,J=(-t+f+z)*(U-$+b),ut=(-t+f)*($-b),et=(f+z)*(-U+$),T=(t+n+i-l-h-f-z)*b,A=z*(-U+$+W-lt-b-nt+ht),ot=(-i+z+p)*(lt+nt-ht),ft=(i-p)*(lt-ht),gt=i*nt,Nt=(z+p)*(-nt+ht),dt=(-i+l+h)*(b+nt-_t),vt=(i-h)*(b-_t),St=(l+h)*(-nt+_t),pt=n*W,Rt=h*ht,Lt=a*$,Pt=f*it,Mt=p*_t,re=k+gt+pt,Ee=Et+yt+Vt+k+ot+gt+Nt,yn=k+J+et+T+gt+dt+St,bn=Ut+wt+yt+k+gt+dt+vt,_n=Ut+yt+Vt+k+Rt,Sn=gt+dt+vt+St+Lt,Mn=k+J+ut+A+ot+ft+gt,En=ot+ft+gt+Nt+Pt,Nn=k+J+ut+et+Mt;return r.set(0,0,re),r.set(0,1,Ee),r.set(0,2,yn),r.set(1,0,bn),r.set(1,1,_n),r.set(1,2,Sn),r.set(2,0,Mn),r.set(2,1,En),r.set(2,2,Nn),r}mmulStrassen(e){e=H.checkMatrix(e);let r=this.clone(),t=r.rows,n=r.columns,i=e.rows,a=e.columns;n!==i&&console.warn(`Multiplying ${t} x ${n} and ${i} x ${a} matrix: dimensions do not match.`);function l(p,U,it){let $=p.rows,W=p.columns;if($===U&&W===it)return p;{let lt=st.zeros(U,it);return lt=lt.setSubMatrix(p,0,0),lt}}let h=Math.max(t,i),f=Math.max(n,a);r=l(r,h,f),e=l(e,h,f);function z(p,U,it,$){if(it<=512||$<=512)return p.mmul(U);it%2===1&&$%2===1?(p=l(p,it+1,$+1),U=l(U,it+1,$+1)):it%2===1?(p=l(p,it+1,$),U=l(U,it+1,$)):$%2===1&&(p=l(p,it,$+1),U=l(U,it,$+1));let W=parseInt(p.rows/2,10),lt=parseInt(p.columns/2,10),b=p.subMatrix(0,W-1,0,lt-1),nt=U.subMatrix(0,W-1,0,lt-1),ht=p.subMatrix(0,W-1,lt,p.columns-1),_t=U.subMatrix(0,W-1,lt,U.columns-1),Et=p.subMatrix(W,p.rows-1,0,lt-1),Ut=U.subMatrix(W,U.rows-1,0,lt-1),wt=p.subMatrix(W,p.rows-1,lt,p.columns-1),yt=U.subMatrix(W,U.rows-1,lt,U.columns-1),Vt=z(st.add(b,wt),st.add(nt,yt),W,lt),k=z(st.add(Et,wt),nt,W,lt),J=z(b,st.sub(_t,yt),W,lt),ut=z(wt,st.sub(Ut,nt),W,lt),et=z(st.add(b,ht),yt,W,lt),T=z(st.sub(Et,b),st.add(nt,_t),W,lt),A=z(st.sub(ht,wt),st.add(Ut,yt),W,lt),ot=st.add(Vt,ut);ot.sub(et),ot.add(A);let ft=st.add(J,et),gt=st.add(k,ut),Nt=st.sub(Vt,k);Nt.add(J),Nt.add(T);let dt=st.zeros(2*ot.rows,2*ot.columns);return dt=dt.setSubMatrix(ot,0,0),dt=dt.setSubMatrix(ft,ot.rows,0),dt=dt.setSubMatrix(gt,0,ot.columns),dt=dt.setSubMatrix(Nt,ot.rows,ot.columns),dt.subMatrix(0,it-1,0,$-1)}return z(r,e,h,f)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new H(this.rows,this.columns);for(let i=0;i<this.rows;i++){const a=this.getRow(i);a.length>0&&u(a,{min:r,max:t,output:a}),n.setRow(i,a)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new H(this.rows,this.columns);for(let i=0;i<this.columns;i++){const a=this.getColumn(i);a.length&&u(a,{min:r,max:t,output:a}),n.setColumn(i,a)}return n}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let n=this.get(r,t),i=this.get(r,this.columns-1-t);this.set(r,t,i),this.set(r,this.columns-1-t,n)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let n=this.get(t,r),i=this.get(this.rows-1-t,r);this.set(t,r,i),this.set(this.rows-1-t,r,n)}return this}kroneckerProduct(e){e=H.checkMatrix(e);let r=this.rows,t=this.columns,n=e.rows,i=e.columns,a=new H(r*n,t*i);for(let l=0;l<r;l++)for(let h=0;h<t;h++)for(let f=0;f<n;f++)for(let z=0;z<i;z++)a.set(n*l+f,i*h+z,this.get(l,h)*e.get(f,z));return a}kroneckerSum(e){if(e=H.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,t=e.rows,n=this.kroneckerProduct(H.eye(t,t)),i=H.eye(r,r).kroneckerProduct(e);return n.add(i)}transpose(){let e=new H(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=It){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=It){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,n){y(this,e,r,t,n);let i=new H(r-e+1,n-t+1);for(let a=e;a<=r;a++)for(let l=t;l<=n;l++)i.set(a-e,l-t,this.get(a,l));return i}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new H(e.length,t-r+1);for(let i=0;i<e.length;i++)for(let a=r;a<=t;a++){if(e[i]<0||e[i]>=this.rows)throw new RangeError(`Row index out of range: ${e[i]}`);n.set(i,a-r,this.get(e[i],a))}return n}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new H(t-r+1,e.length);for(let i=0;i<e.length;i++)for(let a=r;a<=t;a++){if(e[i]<0||e[i]>=this.columns)throw new RangeError(`Column index out of range: ${e[i]}`);n.set(a-r,i,this.get(a,e[i]))}return n}setSubMatrix(e,r,t){if(e=H.checkMatrix(e),e.isEmpty())return this;let n=r+e.rows-1,i=t+e.columns-1;y(this,r,n,t,i);for(let a=0;a<e.rows;a++)for(let l=0;l<e.columns;l++)this.set(r+a,t+l,e.get(a,l));return this}selection(e,r){R(this,e),j(this,r);let t=new H(e.length,r.length);for(let n=0;n<e.length;n++){let i=e[n];for(let a=0;a<r.length;a++){let l=r[a];t.set(n,a,this.get(i,l))}}return t}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){return this.constructor.copy(this,new H(this.rows,this.columns))}static copy(e,r){for(const[t,n,i]of e.entries())r.set(t,n,i);return r}sum(e){switch(e){case"row":return c(this);case"column":return w(this);case void 0:return d(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return O(this);case"column":return q(this);case void 0:return X(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!s.isAnyArray(n))throw new TypeError("mean must be an array");return C(this,t,n)}case"column":{if(!s.isAnyArray(n))throw new TypeError("mean must be an array");return S(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return N(this,t,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!s.isAnyArray(t))throw new TypeError("center must be an array");return x(this,t),this}case"column":{if(!s.isAnyArray(t))throw new TypeError("center must be an array");return G(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return B(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=Q(this);else if(!s.isAnyArray(t))throw new TypeError("scale must be an array");return at(this,t),this}case"column":{if(t===void 0)t=mt(this);else if(!s.isAnyArray(t))throw new TypeError("scale must be an array");return tt(this,t),this}case void 0:{if(t===void 0)t=ct(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return bt(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return _(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)yield[e,r,this.get(e,r)]}*values(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)yield this.get(e,r)}}st.prototype.klass="Matrix",typeof Symbol<"u"&&(st.prototype[Symbol.for("nodejs.util.inspect.custom")]=m);function It(o,e){return o-e}function zt(o){return o.every(e=>typeof e=="number")}st.random=st.rand,st.randomInt=st.randInt,st.diagonal=st.diag,st.prototype.diagonal=st.prototype.diag,st.identity=st.eye,st.prototype.negate=st.prototype.neg,st.prototype.tensorProduct=st.prototype.kroneckerProduct;class H extends st{data;#t(e,r){if(this.data=[],Number.isInteger(r)&&r>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=r}constructor(e,r){if(super(),H.isMatrix(e))this.#t(e.rows,e.columns),H.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#t(e,r);else if(s.isAnyArray(e)){const t=e;if(e=t.length,r=e?t[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(t[n].length!==r)throw new RangeError("Inconsistent array dimensions");if(!zt(t[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[n]))}this.rows=e,this.columns=r}else throw new TypeError("First argument must be a positive number or an array")}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){return Y(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),Y(this,e,!0),r=Float64Array.from(E(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){rt(this,e);for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let n=0;n<e;n++)t[n]=this.data[r][n];for(let n=e+1;n<this.columns;n++)t[n-1]=this.data[r][n];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r>"u"&&(r=e,e=this.columns),rt(this,e,!0),r=L(this,r);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)n[i]=this.data[t][i];for(n[i++]=r[t];i<this.columns+1;i++)n[i]=this.data[t][i-1];this.data[t]=n}return this.columns+=1,this}}F(st,H);class Bt extends st{#t;get size(){return this.#t.size}get rows(){return this.#t.rows}get columns(){return this.#t.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return H.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}constructor(e){if(super(),H.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");this.#t=H.copy(e,new H(e.rows,e.rows))}else if(Number.isInteger(e)&&e>=0)this.#t=new H(e,e);else if(this.#t=new H(e),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const e=new Bt(this.diagonalSize);for(const[r,t,n]of this.upperRightEntries())e.set(r,t,n);return e}toMatrix(){return new H(this)}get(e,r){return this.#t.get(e,r)}set(e,r,t){return this.#t.set(e,r,t),this.#t.set(r,e,t),this}removeCross(e){return this.#t.removeRow(e),this.#t.removeColumn(e),this}addCross(e,r){r===void 0&&(r=e,e=this.diagonalSize);const t=r.slice();return t.splice(e,1),this.#t.addRow(e,t),this.#t.addColumn(e,r),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const r=[];for(const[t,n]of e.entries())n||r.push(t);r.reverse();for(const t of r)this.removeCross(t);return this}toCompact(){const{diagonalSize:e}=this,r=new Array(e*(e+1)/2);for(let t=0,n=0,i=0;i<r.length;i++)r[i]=this.get(n,t),++t>=e&&(t=++n);return r}static fromCompact(e){const r=e.length,t=(Math.sqrt(8*r+1)-1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const n=new Bt(t);for(let i=0,a=0,l=0;l<r;l++)n.set(i,a,e[l]),++i>=t&&(i=++a);return n}*upperRightEntries(){for(let e=0,r=0;e<this.diagonalSize;void 0){const t=this.get(e,r);yield[e,r,t],++r>=this.diagonalSize&&(r=++e)}}*upperRightValues(){for(let e=0,r=0;e<this.diagonalSize;void 0)yield this.get(e,r),++r>=this.diagonalSize&&(r=++e)}}Bt.prototype.klassType="SymmetricMatrix";class ie extends Bt{static isDistanceMatrix(e){return Bt.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,r,t){return e===r&&(t=0),super.set(e,r,t)}addCross(e,r){return r===void 0&&(r=e,e=this.diagonalSize),r=r.slice(),r[e]=0,super.addCross(e,r)}toSymmetricMatrix(){return new Bt(this)}clone(){const e=new ie(this.diagonalSize);for(const[r,t,n]of this.upperRightEntries())r!==t&&e.set(r,t,n);return e}toCompact(){const{diagonalSize:e}=this,r=(e-1)*e/2,t=new Array(r);for(let n=1,i=0,a=0;a<t.length;a++)t[a]=this.get(i,n),++n>=e&&(n=++i+1);return t}static fromCompact(e){const r=e.length;if(r===0)return new this(0);const t=(Math.sqrt(8*r+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const n=new this(t);for(let i=1,a=0,l=0;l<r;l++)n.set(i,a,e[l]),++i>=t&&(i=++a+1);return n}}ie.prototype.klassSubType="DistanceMatrix";class $t extends st{constructor(e,r,t){super(),this.matrix=e,this.rows=r,this.columns=t}}class qt extends $t{constructor(e,r){rt(e,r),super(e,e.rows,1),this.column=r}set(e,r,t){return this.matrix.set(e,this.column,t),this}get(e){return this.matrix.get(e,this.column)}}class Gt extends $t{constructor(e,r){j(e,r),super(e,e.rows,r.length),this.columnIndices=r}set(e,r,t){return this.matrix.set(e,this.columnIndices[r],t),this}get(e,r){return this.matrix.get(e,this.columnIndices[r])}}class At extends $t{constructor(e){super(e,e.rows,e.columns)}set(e,r,t){return this.matrix.set(e,this.columns-r-1,t),this}get(e,r){return this.matrix.get(e,this.columns-r-1)}}class le extends $t{constructor(e){super(e,e.rows,e.columns)}set(e,r,t){return this.matrix.set(this.rows-e-1,r,t),this}get(e,r){return this.matrix.get(this.rows-e-1,r)}}class me extends $t{constructor(e,r){Y(e,r),super(e,1,e.columns),this.row=r}set(e,r,t){return this.matrix.set(this.row,r,t),this}get(e,r){return this.matrix.get(this.row,r)}}class ue extends $t{constructor(e,r){R(e,r),super(e,r.length,e.columns),this.rowIndices=r}set(e,r,t){return this.matrix.set(this.rowIndices[e],r,t),this}get(e,r){return this.matrix.get(this.rowIndices[e],r)}}class ce extends $t{constructor(e,r,t){R(e,r),j(e,t),super(e,r.length,t.length),this.rowIndices=r,this.columnIndices=t}set(e,r,t){return this.matrix.set(this.rowIndices[e],this.columnIndices[r],t),this}get(e,r){return this.matrix.get(this.rowIndices[e],this.columnIndices[r])}}class fe extends $t{constructor(e,r,t,n,i){y(e,r,t,n,i),super(e,t-r+1,i-n+1),this.startRow=r,this.startColumn=n}set(e,r,t){return this.matrix.set(this.startRow+e,this.startColumn+r,t),this}get(e,r){return this.matrix.get(this.startRow+e,this.startColumn+r)}}class ve extends $t{constructor(e){super(e,e.columns,e.rows)}set(e,r,t){return this.matrix.set(r,e,t),this}get(e,r){return this.matrix.get(r,e)}}class Xt extends st{constructor(e,r={}){const{rows:t=1}=r;if(e.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=e.length/t,this.data=e}set(e,r,t){let n=this._calculateIndex(e,r);return this.data[n]=t,this}get(e,r){let t=this._calculateIndex(e,r);return this.data[t]}_calculateIndex(e,r){return e*this.columns+r}}class Yt extends st{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}function ye(o,e){if(s.isAnyArray(o))return o[0]&&s.isAnyArray(o[0])?new Yt(o):new Xt(o,e);throw new Error("the argument is not an array")}class Jt{constructor(e){e=Yt.checkMatrix(e);let r=e.clone(),t=r.rows,n=r.columns,i=new Float64Array(t),a=1,l,h,f,z,p,U,it,$,W;for(l=0;l<t;l++)i[l]=l;for($=new Float64Array(t),h=0;h<n;h++){for(l=0;l<t;l++)$[l]=r.get(l,h);for(l=0;l<t;l++){for(W=Math.min(l,h),p=0,f=0;f<W;f++)p+=r.get(l,f)*$[f];$[l]-=p,r.set(l,h,$[l])}for(z=h,l=h+1;l<t;l++)Math.abs($[l])>Math.abs($[z])&&(z=l);if(z!==h){for(f=0;f<n;f++)U=r.get(z,f),r.set(z,f,r.get(h,f)),r.set(h,f,U);it=i[z],i[z]=i[h],i[h]=it,a=-a}if(h<t&&r.get(h,h)!==0)for(l=h+1;l<t;l++)r.set(l,h,r.get(l,h)/r.get(h,h))}this.LU=r,this.pivotVector=i,this.pivotSign=a}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=H.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,i=e.subMatrixRow(this.pivotVector,0,n-1),a=r.columns,l,h,f;for(f=0;f<a;f++)for(l=f+1;l<a;l++)for(h=0;h<n;h++)i.set(l,h,i.get(l,h)-i.get(f,h)*r.get(l,f));for(f=a-1;f>=0;f--){for(h=0;h<n;h++)i.set(f,h,i.get(f,h)/r.get(f,f));for(l=0;l<f;l++)for(h=0;h<n;h++)i.set(l,h,i.get(l,h)-i.get(f,h)*r.get(l,f))}return i}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let n=0;n<t;n++)r*=e.get(n,n);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new H(r,t);for(let i=0;i<r;i++)for(let a=0;a<t;a++)i>a?n.set(i,a,e.get(i,a)):i===a?n.set(i,a,1):n.set(i,a,0);return n}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new H(r,t);for(let i=0;i<r;i++)for(let a=0;a<t;a++)i<=a?n.set(i,a,e.get(i,a)):n.set(i,a,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ee(o,e){let r=0;return Math.abs(o)>Math.abs(e)?(r=e/o,Math.abs(o)*Math.sqrt(1+r*r)):e!==0?(r=o/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class pe{constructor(e){e=Yt.checkMatrix(e);let r=e.clone(),t=e.rows,n=e.columns,i=new Float64Array(n),a,l,h,f;for(h=0;h<n;h++){let z=0;for(a=h;a<t;a++)z=ee(z,r.get(a,h));if(z!==0){for(r.get(h,h)<0&&(z=-z),a=h;a<t;a++)r.set(a,h,r.get(a,h)/z);for(r.set(h,h,r.get(h,h)+1),l=h+1;l<n;l++){for(f=0,a=h;a<t;a++)f+=r.get(a,h)*r.get(a,l);for(f=-f/r.get(h,h),a=h;a<t;a++)r.set(a,l,r.get(a,l)+f*r.get(a,h))}}i[h]=-z}this.QR=r,this.Rdiag=i}solve(e){e=H.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,i=e.clone(),a=r.columns,l,h,f,z;for(f=0;f<a;f++)for(h=0;h<n;h++){for(z=0,l=f;l<t;l++)z+=r.get(l,f)*i.get(l,h);for(z=-z/r.get(f,f),l=f;l<t;l++)i.set(l,h,i.get(l,h)+z*r.get(l,f))}for(f=a-1;f>=0;f--){for(h=0;h<n;h++)i.set(f,h,i.get(f,h)/this.Rdiag[f]);for(l=0;l<f;l++)for(h=0;h<n;h++)i.set(l,h,i.get(l,h)-i.get(f,h)*r.get(l,f))}return i.subMatrix(0,a-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new H(r,r),n,i;for(n=0;n<r;n++)for(i=0;i<r;i++)n<i?t.set(n,i,e.get(n,i)):n===i?t.set(n,i,this.Rdiag[n]):t.set(n,i,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,n=new H(r,t),i,a,l,h;for(l=t-1;l>=0;l--){for(i=0;i<r;i++)n.set(i,l,0);for(n.set(l,l,1),a=l;a<t;a++)if(e.get(l,l)!==0){for(h=0,i=l;i<r;i++)h+=e.get(i,l)*n.get(i,a);for(h=-h/e.get(l,l),i=l;i<r;i++)n.set(i,a,n.get(i,a)+h*e.get(i,l))}}return n}}class he{constructor(e,r={}){if(e=Yt.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,n=e.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:a=!0,autoTranspose:l=!1}=r;let h=!!i,f=!!a,z=!1,p;if(t<n)if(!l)p=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{p=e.transpose(),t=p.rows,n=p.columns,z=!0;let k=h;h=f,f=k}else p=e.clone();let U=Math.min(t,n),it=Math.min(t+1,n),$=new Float64Array(it),W=new H(t,U),lt=new H(n,n),b=new Float64Array(n),nt=new Float64Array(t),ht=new Float64Array(it);for(let k=0;k<it;k++)ht[k]=k;let _t=Math.min(t-1,n),Et=Math.max(0,Math.min(n-2,t)),Ut=Math.max(_t,Et);for(let k=0;k<Ut;k++){if(k<_t){$[k]=0;for(let J=k;J<t;J++)$[k]=ee($[k],p.get(J,k));if($[k]!==0){p.get(k,k)<0&&($[k]=-$[k]);for(let J=k;J<t;J++)p.set(J,k,p.get(J,k)/$[k]);p.set(k,k,p.get(k,k)+1)}$[k]=-$[k]}for(let J=k+1;J<n;J++){if(k<_t&&$[k]!==0){let ut=0;for(let et=k;et<t;et++)ut+=p.get(et,k)*p.get(et,J);ut=-ut/p.get(k,k);for(let et=k;et<t;et++)p.set(et,J,p.get(et,J)+ut*p.get(et,k))}b[J]=p.get(k,J)}if(h&&k<_t)for(let J=k;J<t;J++)W.set(J,k,p.get(J,k));if(k<Et){b[k]=0;for(let J=k+1;J<n;J++)b[k]=ee(b[k],b[J]);if(b[k]!==0){b[k+1]<0&&(b[k]=0-b[k]);for(let J=k+1;J<n;J++)b[J]/=b[k];b[k+1]+=1}if(b[k]=-b[k],k+1<t&&b[k]!==0){for(let J=k+1;J<t;J++)nt[J]=0;for(let J=k+1;J<t;J++)for(let ut=k+1;ut<n;ut++)nt[J]+=b[ut]*p.get(J,ut);for(let J=k+1;J<n;J++){let ut=-b[J]/b[k+1];for(let et=k+1;et<t;et++)p.set(et,J,p.get(et,J)+ut*nt[et])}}if(f)for(let J=k+1;J<n;J++)lt.set(J,k,b[J])}}let wt=Math.min(n,t+1);if(_t<n&&($[_t]=p.get(_t,_t)),t<wt&&($[wt-1]=0),Et+1<wt&&(b[Et]=p.get(Et,wt-1)),b[wt-1]=0,h){for(let k=_t;k<U;k++){for(let J=0;J<t;J++)W.set(J,k,0);W.set(k,k,1)}for(let k=_t-1;k>=0;k--)if($[k]!==0){for(let J=k+1;J<U;J++){let ut=0;for(let et=k;et<t;et++)ut+=W.get(et,k)*W.get(et,J);ut=-ut/W.get(k,k);for(let et=k;et<t;et++)W.set(et,J,W.get(et,J)+ut*W.get(et,k))}for(let J=k;J<t;J++)W.set(J,k,-W.get(J,k));W.set(k,k,1+W.get(k,k));for(let J=0;J<k-1;J++)W.set(J,k,0)}else{for(let J=0;J<t;J++)W.set(J,k,0);W.set(k,k,1)}}if(f)for(let k=n-1;k>=0;k--){if(k<Et&&b[k]!==0)for(let J=k+1;J<n;J++){let ut=0;for(let et=k+1;et<n;et++)ut+=lt.get(et,k)*lt.get(et,J);ut=-ut/lt.get(k+1,k);for(let et=k+1;et<n;et++)lt.set(et,J,lt.get(et,J)+ut*lt.get(et,k))}for(let J=0;J<n;J++)lt.set(J,k,0);lt.set(k,k,1)}let yt=wt-1,Vt=Number.EPSILON;for(;wt>0;){let k,J;for(k=wt-2;k>=-1&&k!==-1;k--){const ut=Number.MIN_VALUE+Vt*Math.abs($[k]+Math.abs($[k+1]));if(Math.abs(b[k])<=ut||Number.isNaN(b[k])){b[k]=0;break}}if(k===wt-2)J=4;else{let ut;for(ut=wt-1;ut>=k&&ut!==k;ut--){let et=(ut!==wt?Math.abs(b[ut]):0)+(ut!==k+1?Math.abs(b[ut-1]):0);if(Math.abs($[ut])<=Vt*et){$[ut]=0;break}}ut===k?J=3:ut===wt-1?J=1:(J=2,k=ut)}switch(k++,J){case 1:{let ut=b[wt-2];b[wt-2]=0;for(let et=wt-2;et>=k;et--){let T=ee($[et],ut),A=$[et]/T,ot=ut/T;if($[et]=T,et!==k&&(ut=-ot*b[et-1],b[et-1]=A*b[et-1]),f)for(let ft=0;ft<n;ft++)T=A*lt.get(ft,et)+ot*lt.get(ft,wt-1),lt.set(ft,wt-1,-ot*lt.get(ft,et)+A*lt.get(ft,wt-1)),lt.set(ft,et,T)}break}case 2:{let ut=b[k-1];b[k-1]=0;for(let et=k;et<wt;et++){let T=ee($[et],ut),A=$[et]/T,ot=ut/T;if($[et]=T,ut=-ot*b[et],b[et]=A*b[et],h)for(let ft=0;ft<t;ft++)T=A*W.get(ft,et)+ot*W.get(ft,k-1),W.set(ft,k-1,-ot*W.get(ft,et)+A*W.get(ft,k-1)),W.set(ft,et,T)}break}case 3:{const ut=Math.max(Math.abs($[wt-1]),Math.abs($[wt-2]),Math.abs(b[wt-2]),Math.abs($[k]),Math.abs(b[k])),et=$[wt-1]/ut,T=$[wt-2]/ut,A=b[wt-2]/ut,ot=$[k]/ut,ft=b[k]/ut,gt=((T+et)*(T-et)+A*A)/2,Nt=et*A*(et*A);let dt=0;(gt!==0||Nt!==0)&&(gt<0?dt=0-Math.sqrt(gt*gt+Nt):dt=Math.sqrt(gt*gt+Nt),dt=Nt/(gt+dt));let vt=(ot+et)*(ot-et)+dt,St=ot*ft;for(let pt=k;pt<wt-1;pt++){let Rt=ee(vt,St);Rt===0&&(Rt=Number.MIN_VALUE);let Lt=vt/Rt,Pt=St/Rt;if(pt!==k&&(b[pt-1]=Rt),vt=Lt*$[pt]+Pt*b[pt],b[pt]=Lt*b[pt]-Pt*$[pt],St=Pt*$[pt+1],$[pt+1]=Lt*$[pt+1],f)for(let Mt=0;Mt<n;Mt++)Rt=Lt*lt.get(Mt,pt)+Pt*lt.get(Mt,pt+1),lt.set(Mt,pt+1,-Pt*lt.get(Mt,pt)+Lt*lt.get(Mt,pt+1)),lt.set(Mt,pt,Rt);if(Rt=ee(vt,St),Rt===0&&(Rt=Number.MIN_VALUE),Lt=vt/Rt,Pt=St/Rt,$[pt]=Rt,vt=Lt*b[pt]+Pt*$[pt+1],$[pt+1]=-Pt*b[pt]+Lt*$[pt+1],St=Pt*b[pt+1],b[pt+1]=Lt*b[pt+1],h&&pt<t-1)for(let Mt=0;Mt<t;Mt++)Rt=Lt*W.get(Mt,pt)+Pt*W.get(Mt,pt+1),W.set(Mt,pt+1,-Pt*W.get(Mt,pt)+Lt*W.get(Mt,pt+1)),W.set(Mt,pt,Rt)}b[wt-2]=vt;break}case 4:{if($[k]<=0&&($[k]=$[k]<0?-$[k]:0,f))for(let ut=0;ut<=yt;ut++)lt.set(ut,k,-lt.get(ut,k));for(;k<yt&&!($[k]>=$[k+1]);){let ut=$[k];if($[k]=$[k+1],$[k+1]=ut,f&&k<n-1)for(let et=0;et<n;et++)ut=lt.get(et,k+1),lt.set(et,k+1,lt.get(et,k)),lt.set(et,k,ut);if(h&&k<t-1)for(let et=0;et<t;et++)ut=W.get(et,k+1),W.set(et,k+1,W.get(et,k)),W.set(et,k,ut);k++}wt--;break}}}if(z){let k=lt;lt=W,W=k}this.m=t,this.n=n,this.s=$,this.U=W,this.V=lt}solve(e){let r=e,t=this.threshold,n=this.s.length,i=H.zeros(n,n);for(let U=0;U<n;U++)Math.abs(this.s[U])<=t?i.set(U,U,0):i.set(U,U,1/this.s[U]);let a=this.U,l=this.rightSingularVectors,h=l.mmul(i),f=l.rows,z=a.rows,p=H.zeros(f,z);for(let U=0;U<f;U++)for(let it=0;it<z;it++){let $=0;for(let W=0;W<n;W++)$+=h.get(U,W)*a.get(it,W);p.set(U,it,$)}return p.mmul(r)}solveForDiagonal(e){return this.solve(H.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,n=e.columns,i=new H(t,this.s.length);for(let z=0;z<t;z++)for(let p=0;p<n;p++)Math.abs(this.s[p])>r&&i.set(z,p,e.get(z,p)/this.s[p]);let a=this.U,l=a.rows,h=a.columns,f=new H(t,l);for(let z=0;z<t;z++)for(let p=0;p<l;p++){let U=0;for(let it=0;it<h;it++)U+=i.get(z,it)*a.get(p,it);f.set(z,p,U)}return f}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let n=0,i=t.length;n<i;n++)t[n]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return H.diag(this.s)}}function de(o,e=!1){return o=Yt.checkMatrix(o),e?new he(o).inverse():Oe(o,H.eye(o.rows))}function Oe(o,e,r=!1){return o=Yt.checkMatrix(o),e=Yt.checkMatrix(e),r?new he(o).solve(e):o.isSquare()?new Jt(o).solve(e):new pe(o).solve(e)}function ke(o){if(o=H.checkMatrix(o),o.isSquare()){if(o.columns===0)return 1;let e,r,t,n;if(o.columns===2)return e=o.get(0,0),r=o.get(0,1),t=o.get(1,0),n=o.get(1,1),e*n-r*t;if(o.columns===3){let i,a,l;return i=new ce(o,[1,2],[1,2]),a=new ce(o,[1,2],[0,2]),l=new ce(o,[1,2],[0,1]),e=o.get(0,0),r=o.get(0,1),t=o.get(0,2),e*ke(i)-r*ke(a)+t*ke(l)}else return new Jt(o).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Fe(o,e){let r=[];for(let t=0;t<o;t++)t!==e&&r.push(t);return r}function Ge(o,e,r,t=1e-9,n=1e-9){if(o>n)return new Array(e.rows+1).fill(0);{let i=e.addRow(r,[0]);for(let a=0;a<i.rows;a++)Math.abs(i.get(a,0))<t&&i.set(a,0,0);return i.to1DArray()}}function fr(o,e={}){const{thresholdValue:r=1e-9,thresholdError:t=1e-9}=e;o=H.checkMatrix(o);let n=o.rows,i=new H(n,n);for(let a=0;a<n;a++){let l=H.columnVector(o.getRow(a)),h=o.subMatrixRow(Fe(n,a)).transpose(),z=new he(h).solve(l),p=H.sub(l,h.mmul(z)).abs().max();i.setRow(a,Ge(p,z,a,r,t))}return i}function Je(o,e=Number.EPSILON){if(o=H.checkMatrix(o),o.isEmpty())return o.transpose();let r=new he(o,{autoTranspose:!0}),t=r.leftSingularVectors,n=r.rightSingularVectors,i=r.diagonal;for(let a=0;a<i.length;a++)Math.abs(i[a])>e?i[a]=1/i[a]:i[a]=0;return n.mmul(H.diag(i).mmul(t.transpose()))}function Ze(o,e=o,r={}){o=new H(o);let t=!1;if(typeof e=="object"&&!H.isMatrix(e)&&!s.isAnyArray(e)?(r=e,e=o,t=!0):e=new H(e),o.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=r;n&&(o=o.center("column"),t||(e=e.center("column")));const i=o.transpose().mmul(e);for(let a=0;a<i.rows;a++)for(let l=0;l<i.columns;l++)i.set(a,l,i.get(a,l)*(1/(o.rows-1)));return i}function cr(o,e=o,r={}){o=new H(o);let t=!1;if(typeof e=="object"&&!H.isMatrix(e)&&!s.isAnyArray(e)?(r=e,e=o,t=!0):e=new H(e),o.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:i=!0}=r;n&&(o.center("column"),t||e.center("column")),i&&(o.scale("column"),t||e.scale("column"));const a=o.standardDeviation("column",{unbiased:!0}),l=t?a:e.standardDeviation("column",{unbiased:!0}),h=o.transpose().mmul(e);for(let f=0;f<h.rows;f++)for(let z=0;z<h.columns;z++)h.set(f,z,h.get(f,z)*(1/(a[f]*l[z]))*(1/(o.rows-1)));return h}class Re{constructor(e,r={}){const{assumeSymmetric:t=!1}=r;if(e=Yt.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.columns,i=new H(n,n),a=new Float64Array(n),l=new Float64Array(n),h=e,f,z,p=!1;if(t?p=!0:p=e.isSymmetric(),p){for(f=0;f<n;f++)for(z=0;z<n;z++)i.set(f,z,h.get(f,z));He(n,l,a,i),Ce(n,l,a,i)}else{let U=new H(n,n),it=new Float64Array(n);for(z=0;z<n;z++)for(f=0;f<n;f++)U.set(f,z,h.get(f,z));De(n,U,it,i),Le(n,l,a,i,U)}this.n=n,this.e=l,this.d=a,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,r=this.e,t=this.d,n=new H(e,e),i,a;for(i=0;i<e;i++){for(a=0;a<e;a++)n.set(i,a,0);n.set(i,i,t[i]),r[i]>0?n.set(i,i+1,r[i]):r[i]<0&&n.set(i,i-1,r[i])}return n}}function He(o,e,r,t){let n,i,a,l,h,f,z,p;for(h=0;h<o;h++)r[h]=t.get(o-1,h);for(l=o-1;l>0;l--){for(p=0,a=0,f=0;f<l;f++)p=p+Math.abs(r[f]);if(p===0)for(e[l]=r[l-1],h=0;h<l;h++)r[h]=t.get(l-1,h),t.set(l,h,0),t.set(h,l,0);else{for(f=0;f<l;f++)r[f]/=p,a+=r[f]*r[f];for(n=r[l-1],i=Math.sqrt(a),n>0&&(i=-i),e[l]=p*i,a=a-n*i,r[l-1]=n-i,h=0;h<l;h++)e[h]=0;for(h=0;h<l;h++){for(n=r[h],t.set(h,l,n),i=e[h]+t.get(h,h)*n,f=h+1;f<=l-1;f++)i+=t.get(f,h)*r[f],e[f]+=t.get(f,h)*n;e[h]=i}for(n=0,h=0;h<l;h++)e[h]/=a,n+=e[h]*r[h];for(z=n/(a+a),h=0;h<l;h++)e[h]-=z*r[h];for(h=0;h<l;h++){for(n=r[h],i=e[h],f=h;f<=l-1;f++)t.set(f,h,t.get(f,h)-(n*e[f]+i*r[f]));r[h]=t.get(l-1,h),t.set(l,h,0)}}r[l]=a}for(l=0;l<o-1;l++){if(t.set(o-1,l,t.get(l,l)),t.set(l,l,1),a=r[l+1],a!==0){for(f=0;f<=l;f++)r[f]=t.get(f,l+1)/a;for(h=0;h<=l;h++){for(i=0,f=0;f<=l;f++)i+=t.get(f,l+1)*t.get(f,h);for(f=0;f<=l;f++)t.set(f,h,t.get(f,h)-i*r[f])}}for(f=0;f<=l;f++)t.set(f,l+1,0)}for(h=0;h<o;h++)r[h]=t.get(o-1,h),t.set(o-1,h,0);t.set(o-1,o-1,1),e[0]=0}function Ce(o,e,r,t){let n,i,a,l,h,f,z,p,U,it,$,W,lt,b,nt,ht;for(a=1;a<o;a++)e[a-1]=e[a];e[o-1]=0;let _t=0,Et=0,Ut=Number.EPSILON;for(f=0;f<o;f++){for(Et=Math.max(Et,Math.abs(r[f])+Math.abs(e[f])),z=f;z<o&&!(Math.abs(e[z])<=Ut*Et);)z++;if(z>f)do{for(n=r[f],p=(r[f+1]-n)/(2*e[f]),U=ee(p,1),p<0&&(U=-U),r[f]=e[f]/(p+U),r[f+1]=e[f]*(p+U),it=r[f+1],i=n-r[f],a=f+2;a<o;a++)r[a]-=i;for(_t=_t+i,p=r[z],$=1,W=$,lt=$,b=e[f+1],nt=0,ht=0,a=z-1;a>=f;a--)for(lt=W,W=$,ht=nt,n=$*e[a],i=$*p,U=ee(p,e[a]),e[a+1]=nt*U,nt=e[a]/U,$=p/U,p=$*r[a]-nt*n,r[a+1]=i+nt*($*n+nt*r[a]),h=0;h<o;h++)i=t.get(h,a+1),t.set(h,a+1,nt*t.get(h,a)+$*i),t.set(h,a,$*t.get(h,a)-nt*i);p=-nt*ht*lt*b*e[f]/it,e[f]=nt*p,r[f]=$*p}while(Math.abs(e[f])>Ut*Et);r[f]=r[f]+_t,e[f]=0}for(a=0;a<o-1;a++){for(h=a,p=r[a],l=a+1;l<o;l++)r[l]<p&&(h=l,p=r[l]);if(h!==a)for(r[h]=r[a],r[a]=p,l=0;l<o;l++)p=t.get(l,a),t.set(l,a,t.get(l,h)),t.set(l,h,p)}}function De(o,e,r,t){let n=0,i=o-1,a,l,h,f,z,p,U;for(p=n+1;p<=i-1;p++){for(U=0,f=p;f<=i;f++)U=U+Math.abs(e.get(f,p-1));if(U!==0){for(h=0,f=i;f>=p;f--)r[f]=e.get(f,p-1)/U,h+=r[f]*r[f];for(l=Math.sqrt(h),r[p]>0&&(l=-l),h=h-r[p]*l,r[p]=r[p]-l,z=p;z<o;z++){for(a=0,f=i;f>=p;f--)a+=r[f]*e.get(f,z);for(a=a/h,f=p;f<=i;f++)e.set(f,z,e.get(f,z)-a*r[f])}for(f=0;f<=i;f++){for(a=0,z=i;z>=p;z--)a+=r[z]*e.get(f,z);for(a=a/h,z=p;z<=i;z++)e.set(f,z,e.get(f,z)-a*r[z])}r[p]=U*r[p],e.set(p,p-1,U*l)}}for(f=0;f<o;f++)for(z=0;z<o;z++)t.set(f,z,f===z?1:0);for(p=i-1;p>=n+1;p--)if(e.get(p,p-1)!==0){for(f=p+1;f<=i;f++)r[f]=e.get(f,p-1);for(z=p;z<=i;z++){for(l=0,f=p;f<=i;f++)l+=r[f]*t.get(f,z);for(l=l/r[p]/e.get(p,p-1),f=p;f<=i;f++)t.set(f,z,t.get(f,z)+l*r[f])}}}function Le(o,e,r,t,n){let i=o-1,a=0,l=o-1,h=Number.EPSILON,f=0,z=0,p=0,U=0,it=0,$=0,W=0,lt=0,b,nt,ht,_t,Et,Ut,wt,yt,Vt,k,J,ut,et,T,A;for(b=0;b<o;b++)for((b<a||b>l)&&(r[b]=n.get(b,b),e[b]=0),nt=Math.max(b-1,0);nt<o;nt++)z=z+Math.abs(n.get(b,nt));for(;i>=a;){for(_t=i;_t>a&&($=Math.abs(n.get(_t-1,_t-1))+Math.abs(n.get(_t,_t)),$===0&&($=z),!(Math.abs(n.get(_t,_t-1))<h*$));)_t--;if(_t===i)n.set(i,i,n.get(i,i)+f),r[i]=n.get(i,i),e[i]=0,i--,lt=0;else if(_t===i-1){if(wt=n.get(i,i-1)*n.get(i-1,i),p=(n.get(i-1,i-1)-n.get(i,i))/2,U=p*p+wt,W=Math.sqrt(Math.abs(U)),n.set(i,i,n.get(i,i)+f),n.set(i-1,i-1,n.get(i-1,i-1)+f),yt=n.get(i,i),U>=0){for(W=p>=0?p+W:p-W,r[i-1]=yt+W,r[i]=r[i-1],W!==0&&(r[i]=yt-wt/W),e[i-1]=0,e[i]=0,yt=n.get(i,i-1),$=Math.abs(yt)+Math.abs(W),p=yt/$,U=W/$,it=Math.sqrt(p*p+U*U),p=p/it,U=U/it,nt=i-1;nt<o;nt++)W=n.get(i-1,nt),n.set(i-1,nt,U*W+p*n.get(i,nt)),n.set(i,nt,U*n.get(i,nt)-p*W);for(b=0;b<=i;b++)W=n.get(b,i-1),n.set(b,i-1,U*W+p*n.get(b,i)),n.set(b,i,U*n.get(b,i)-p*W);for(b=a;b<=l;b++)W=t.get(b,i-1),t.set(b,i-1,U*W+p*t.get(b,i)),t.set(b,i,U*t.get(b,i)-p*W)}else r[i-1]=yt+p,r[i]=yt+p,e[i-1]=W,e[i]=-W;i=i-2,lt=0}else{if(yt=n.get(i,i),Vt=0,wt=0,_t<i&&(Vt=n.get(i-1,i-1),wt=n.get(i,i-1)*n.get(i-1,i)),lt===10){for(f+=yt,b=a;b<=i;b++)n.set(b,b,n.get(b,b)-yt);$=Math.abs(n.get(i,i-1))+Math.abs(n.get(i-1,i-2)),yt=Vt=.75*$,wt=-.4375*$*$}if(lt===30&&($=(Vt-yt)/2,$=$*$+wt,$>0)){for($=Math.sqrt($),Vt<yt&&($=-$),$=yt-wt/((Vt-yt)/2+$),b=a;b<=i;b++)n.set(b,b,n.get(b,b)-$);f+=$,yt=Vt=wt=.964}for(lt=lt+1,Et=i-2;Et>=_t&&(W=n.get(Et,Et),it=yt-W,$=Vt-W,p=(it*$-wt)/n.get(Et+1,Et)+n.get(Et,Et+1),U=n.get(Et+1,Et+1)-W-it-$,it=n.get(Et+2,Et+1),$=Math.abs(p)+Math.abs(U)+Math.abs(it),p=p/$,U=U/$,it=it/$,!(Et===_t||Math.abs(n.get(Et,Et-1))*(Math.abs(U)+Math.abs(it))<h*(Math.abs(p)*(Math.abs(n.get(Et-1,Et-1))+Math.abs(W)+Math.abs(n.get(Et+1,Et+1))))));)Et--;for(b=Et+2;b<=i;b++)n.set(b,b-2,0),b>Et+2&&n.set(b,b-3,0);for(ht=Et;ht<=i-1&&(T=ht!==i-1,ht!==Et&&(p=n.get(ht,ht-1),U=n.get(ht+1,ht-1),it=T?n.get(ht+2,ht-1):0,yt=Math.abs(p)+Math.abs(U)+Math.abs(it),yt!==0&&(p=p/yt,U=U/yt,it=it/yt)),yt!==0);ht++)if($=Math.sqrt(p*p+U*U+it*it),p<0&&($=-$),$!==0){for(ht!==Et?n.set(ht,ht-1,-$*yt):_t!==Et&&n.set(ht,ht-1,-n.get(ht,ht-1)),p=p+$,yt=p/$,Vt=U/$,W=it/$,U=U/p,it=it/p,nt=ht;nt<o;nt++)p=n.get(ht,nt)+U*n.get(ht+1,nt),T&&(p=p+it*n.get(ht+2,nt),n.set(ht+2,nt,n.get(ht+2,nt)-p*W)),n.set(ht,nt,n.get(ht,nt)-p*yt),n.set(ht+1,nt,n.get(ht+1,nt)-p*Vt);for(b=0;b<=Math.min(i,ht+3);b++)p=yt*n.get(b,ht)+Vt*n.get(b,ht+1),T&&(p=p+W*n.get(b,ht+2),n.set(b,ht+2,n.get(b,ht+2)-p*it)),n.set(b,ht,n.get(b,ht)-p),n.set(b,ht+1,n.get(b,ht+1)-p*U);for(b=a;b<=l;b++)p=yt*t.get(b,ht)+Vt*t.get(b,ht+1),T&&(p=p+W*t.get(b,ht+2),t.set(b,ht+2,t.get(b,ht+2)-p*it)),t.set(b,ht,t.get(b,ht)-p),t.set(b,ht+1,t.get(b,ht+1)-p*U)}}}if(z!==0){for(i=o-1;i>=0;i--)if(p=r[i],U=e[i],U===0)for(_t=i,n.set(i,i,1),b=i-1;b>=0;b--){for(wt=n.get(b,b)-p,it=0,nt=_t;nt<=i;nt++)it=it+n.get(b,nt)*n.get(nt,i);if(e[b]<0)W=wt,$=it;else if(_t=b,e[b]===0?n.set(b,i,wt!==0?-it/wt:-it/(h*z)):(yt=n.get(b,b+1),Vt=n.get(b+1,b),U=(r[b]-p)*(r[b]-p)+e[b]*e[b],Ut=(yt*$-W*it)/U,n.set(b,i,Ut),n.set(b+1,i,Math.abs(yt)>Math.abs(W)?(-it-wt*Ut)/yt:(-$-Vt*Ut)/W)),Ut=Math.abs(n.get(b,i)),h*Ut*Ut>1)for(nt=b;nt<=i;nt++)n.set(nt,i,n.get(nt,i)/Ut)}else if(U<0)for(_t=i-1,Math.abs(n.get(i,i-1))>Math.abs(n.get(i-1,i))?(n.set(i-1,i-1,U/n.get(i,i-1)),n.set(i-1,i,-(n.get(i,i)-p)/n.get(i,i-1))):(A=Me(0,-n.get(i-1,i),n.get(i-1,i-1)-p,U),n.set(i-1,i-1,A[0]),n.set(i-1,i,A[1])),n.set(i,i-1,0),n.set(i,i,1),b=i-2;b>=0;b--){for(k=0,J=0,nt=_t;nt<=i;nt++)k=k+n.get(b,nt)*n.get(nt,i-1),J=J+n.get(b,nt)*n.get(nt,i);if(wt=n.get(b,b)-p,e[b]<0)W=wt,it=k,$=J;else if(_t=b,e[b]===0?(A=Me(-k,-J,wt,U),n.set(b,i-1,A[0]),n.set(b,i,A[1])):(yt=n.get(b,b+1),Vt=n.get(b+1,b),ut=(r[b]-p)*(r[b]-p)+e[b]*e[b]-U*U,et=(r[b]-p)*2*U,ut===0&&et===0&&(ut=h*z*(Math.abs(wt)+Math.abs(U)+Math.abs(yt)+Math.abs(Vt)+Math.abs(W))),A=Me(yt*it-W*k+U*J,yt*$-W*J-U*k,ut,et),n.set(b,i-1,A[0]),n.set(b,i,A[1]),Math.abs(yt)>Math.abs(W)+Math.abs(U)?(n.set(b+1,i-1,(-k-wt*n.get(b,i-1)+U*n.get(b,i))/yt),n.set(b+1,i,(-J-wt*n.get(b,i)-U*n.get(b,i-1))/yt)):(A=Me(-it-Vt*n.get(b,i-1),-$-Vt*n.get(b,i),W,U),n.set(b+1,i-1,A[0]),n.set(b+1,i,A[1]))),Ut=Math.max(Math.abs(n.get(b,i-1)),Math.abs(n.get(b,i))),h*Ut*Ut>1)for(nt=b;nt<=i;nt++)n.set(nt,i-1,n.get(nt,i-1)/Ut),n.set(nt,i,n.get(nt,i)/Ut)}for(b=0;b<o;b++)if(b<a||b>l)for(nt=b;nt<o;nt++)t.set(b,nt,n.get(b,nt));for(nt=o-1;nt>=a;nt--)for(b=a;b<=l;b++){for(W=0,ht=a;ht<=Math.min(nt,l);ht++)W=W+t.get(b,ht)*n.get(ht,nt);t.set(b,nt,W)}}}function Me(o,e,r,t){let n,i;return Math.abs(r)>Math.abs(t)?(n=t/r,i=r+n*t,[(o+n*e)/i,(e-n*o)/i]):(n=r/t,i=t+n*r,[(n*o+e)/i,(n*e-o)/i])}class Ie{constructor(e){if(e=Yt.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let r=e,t=r.rows,n=new H(t,t),i=!0,a,l,h;for(l=0;l<t;l++){let f=0;for(h=0;h<l;h++){let z=0;for(a=0;a<h;a++)z+=n.get(h,a)*n.get(l,a);z=(r.get(l,h)-z)/n.get(h,h),n.set(l,h,z),f=f+z*z}for(f=r.get(l,l)-f,i&&=f>0,n.set(l,l,Math.sqrt(Math.max(f,0))),h=l+1;h<t;h++)n.set(l,h,0)}this.L=n,this.positiveDefinite=i}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=Yt.checkMatrix(e);let r=this.L,t=r.rows;if(e.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=e.columns,i=e.clone(),a,l,h;for(h=0;h<t;h++)for(l=0;l<n;l++){for(a=0;a<h;a++)i.set(h,l,i.get(h,l)-i.get(a,l)*r.get(h,a));i.set(h,l,i.get(h,l)/r.get(h,h))}for(h=t-1;h>=0;h--)for(l=0;l<n;l++){for(a=h+1;a<t;a++)i.set(h,l,i.get(h,l)-i.get(a,l)*r.get(a,h));i.set(h,l,i.get(h,l)/r.get(h,h))}return i}get lowerTriangularMatrix(){return this.L}}class qe{constructor(e,r={}){e=Yt.checkMatrix(e);let{Y:t}=r;const{scaleScores:n=!1,maxIterations:i=1e3,terminationCriteria:a=1e-10}=r;let l;if(t){if(s.isAnyArray(t)&&typeof t[0]=="number"?t=H.columnVector(t):t=Yt.checkMatrix(t),t.rows!==e.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=e.getColumnVector(0);let h=1,f,z,p,U;for(let it=0;it<i&&h>a;it++)p=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),p=p.div(p.norm()),f=e.mmul(p).div(p.transpose().mmul(p).get(0,0)),it>0&&(h=f.clone().sub(U).pow(2).sum()),U=f.clone(),t?(z=t.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0)),z=z.div(z.norm()),l=t.mmul(z).div(z.transpose().mmul(z).get(0,0))):l=f;if(t){let it=e.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0));it=it.div(it.norm());let $=e.clone().sub(f.clone().mmul(it.transpose())),W=l.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0)),lt=t.clone().sub(f.clone().mulS(W.get(0,0)).mmul(z.transpose()));this.t=f,this.p=it.transpose(),this.w=p.transpose(),this.q=z,this.u=l,this.s=f.transpose().mmul(f),this.xResidual=$,this.yResidual=lt,this.betas=W}else this.w=p.transpose(),this.s=f.transpose().mmul(f).sqrt(),n?this.t=f.clone().div(this.s.get(0,0)):this.t=f,this.xResidual=e.sub(f.mmul(p.transpose()))}}return Tt.AbstractMatrix=st,Tt.CHO=Ie,Tt.CholeskyDecomposition=Ie,Tt.DistanceMatrix=ie,Tt.EVD=Re,Tt.EigenvalueDecomposition=Re,Tt.LU=Jt,Tt.LuDecomposition=Jt,Tt.Matrix=H,Tt.MatrixColumnSelectionView=Gt,Tt.MatrixColumnView=qt,Tt.MatrixFlipColumnView=At,Tt.MatrixFlipRowView=le,Tt.MatrixRowSelectionView=ue,Tt.MatrixRowView=me,Tt.MatrixSelectionView=ce,Tt.MatrixSubView=fe,Tt.MatrixTransposeView=ve,Tt.NIPALS=qe,Tt.Nipals=qe,Tt.QR=pe,Tt.QrDecomposition=pe,Tt.SVD=he,Tt.SingularValueDecomposition=he,Tt.SymmetricMatrix=Bt,Tt.WrapperMatrix1D=Xt,Tt.WrapperMatrix2D=Yt,Tt.correlation=cr,Tt.covariance=Ze,Tt.default=H,Tt.determinant=ke,Tt.inverse=de,Tt.linearDependencies=fr,Tt.pseudoInverse=Je,Tt.solve=Oe,Tt.wrap=ye,Tt}var ur=Oi();const Gr=di(ur),or=ur.Matrix;Gr.Matrix?Gr.Matrix:ur.Matrix;const Fi=ur.inverse;function Ci(s,u,g,v,m){const _=g.length,D=s.x.length;let V=new Array(_);for(let K=0;K<_;K++){V[K]=new Array(D);let F=g.slice();F[K]+=v;let Y=m(F);for(let rt=0;rt<D;rt++)V[K][rt]=u[rt]-Y(s.x[rt])}return new or(V)}function Di(s,u){const g=s.x.length;let v=new Array(g);for(let m=0;m<g;m++)v[m]=[s.y[m]-u[m]];return new or(v)}function Li(s,u,g,v,m){let _=g*v*v,D=or.eye(u.length,u.length,_);const V=m(u);let K=new Float64Array(s.x.length);for(let E=0;E<s.x.length;E++)K[E]=V(s.x[E]);let F=Ci(s,K,u,v,m),Y=Di(s,K),rt=Fi(D.add(F.mmul(F.transpose())));return u=new or([u]),u=u.sub(rt.mmul(F).mmul(Y).mul(v).transpose()),u.to1DArray()}function qi(s,u,g={}){let{maxIterations:v=100,gradientDifference:m=.1,damping:_=0,errorTolerance:D=.01,minValues:V,maxValues:K,initialValues:F}=g;if(_<=0)throw new Error("The damping option must be a positive number");if(!s.x||!s.y)throw new Error("The data parameter must have x and y elements");if(!Sr(s.x)||s.x.length<2||!Sr(s.y)||s.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(s.x.length!==s.y.length)throw new Error("The data parameter elements must have the same size");let Y=F||new Array(u.length).fill(1),rt=Y.length;if(K=K||new Array(rt).fill(Number.MAX_SAFE_INTEGER),V=V||new Array(rt).fill(Number.MIN_SAFE_INTEGER),K.length!==V.length)throw new Error("minValues and maxValues must be the same size");if(!Sr(Y))throw new Error("initialValues must be an array");let E=Kr(s,Y,u),L=E<=D,R;for(R=0;R<v&&!L;R++){Y=Li(s,Y,_,m,u);for(let j=0;j<rt;j++)Y[j]=Math.min(Math.max(V[j],Y[j]),K[j]);if(E=Kr(s,Y,u),isNaN(E))break;L=E<=D}return{parameterValues:Y,parameterError:E,iterations:R}}const Vi=Object.freeze(Object.defineProperty({__proto__:null,default:qi},Symbol.toStringTag,{value:"Module"})),Bi=Ir(Vi);var Jr;function $i(){if(Jr)return Ct;Jr=1;var s=Ct&&Ct.__createBinding||(Object.create?(function(C,S,N,x){x===void 0&&(x=N),Object.defineProperty(C,x,{enumerable:!0,get:function(){return S[N]}})}):(function(C,S,N,x){x===void 0&&(x=N),C[x]=S[N]})),u=Ct&&Ct.__setModuleDefault||(Object.create?(function(C,S){Object.defineProperty(C,"default",{enumerable:!0,value:S})}):function(C,S){C.default=S}),g=Ct&&Ct.__importStar||function(C){if(C&&C.__esModule)return C;var S={};if(C!=null)for(var N in C)N!=="default"&&Object.hasOwnProperty.call(C,N)&&s(S,C,N);return u(S,C),S},v=Ct&&Ct.__awaiter||function(C,S,N,x){function G(B){return B instanceof N?B:new N(function(Q){Q(B)})}return new(N||(N=Promise))(function(B,Q){function at(ct){try{tt(x.next(ct))}catch(bt){Q(bt)}}function mt(ct){try{tt(x.throw(ct))}catch(bt){Q(bt)}}function tt(ct){ct.done?B(ct.value):G(ct.value).then(at,mt)}tt((x=x.apply(C,S||[])).next())})},m=Ct&&Ct.__generator||function(C,S){var N={label:0,sent:function(){if(B[0]&1)throw B[1];return B[1]},trys:[],ops:[]},x,G,B,Q;return Q={next:at(0),throw:at(1),return:at(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function at(tt){return function(ct){return mt([tt,ct])}}function mt(tt){if(x)throw new TypeError("Generator is already executing.");for(;N;)try{if(x=1,G&&(B=tt[0]&2?G.return:tt[0]?G.throw||((B=G.return)&&B.call(G),0):G.next)&&!(B=B.call(G,tt[1])).done)return B;switch(G=0,B&&(tt=[tt[0]&2,B.value]),tt[0]){case 0:case 1:B=tt;break;case 4:return N.label++,{value:tt[1],done:!1};case 5:N.label++,G=tt[1],tt=[0];continue;case 7:tt=N.ops.pop(),N.trys.pop();continue;default:if(B=N.trys,!(B=B.length>0&&B[B.length-1])&&(tt[0]===6||tt[0]===2)){N=0;continue}if(tt[0]===3&&(!B||tt[1]>B[0]&&tt[1]<B[3])){N.label=tt[1];break}if(tt[0]===6&&N.label<B[1]){N.label=B[1],B=tt;break}if(B&&N.label<B[2]){N.label=B[2],N.ops.push(tt);break}B[2]&&N.ops.pop(),N.trys.pop();continue}tt=S.call(C,N)}catch(ct){tt=[6,ct],G=0}finally{x=B=0}if(tt[0]&5)throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}},_=Ct&&Ct.__read||function(C,S){var N=typeof Symbol=="function"&&C[Symbol.iterator];if(!N)return C;var x=N.call(C),G,B=[],Q;try{for(;(S===void 0||S-- >0)&&!(G=x.next()).done;)B.push(G.value)}catch(at){Q={error:at}}finally{try{G&&!G.done&&(N=x.return)&&N.call(x)}finally{if(Q)throw Q.error}}return B},D=Ct&&Ct.__spread||function(){for(var C=[],S=0;S<arguments.length;S++)C=C.concat(_(arguments[S]));return C},V=Ct&&Ct.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.initTransform=Ct.resetLocalConnectivity=Ct.fastIntersection=Ct.findABParams=Ct.cosine=Ct.euclidean=Ct.UMAP=void 0;var K=g(hn()),F=g(fn()),Y=g(wi()),rt=g(cn()),E=g(Xe()),L=V(Bi),R=1e-5,j=.001,y=(function(){function C(S){var N=this;S===void 0&&(S={}),this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=I,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new M;var x=function(G){S[G]!==void 0&&(N[G]=S[G])};x("distanceFn"),x("learningRate"),x("localConnectivity"),x("minDist"),x("nComponents"),x("nEpochs"),x("nNeighbors"),x("negativeSampleRate"),x("random"),x("repulsionStrength"),x("setOpMixRatio"),x("spread"),x("transformQueueSize")}return C.prototype.fit=function(S){return this.initializeFit(S),this.optimizeLayout(),this.embedding},C.prototype.fitAsync=function(S,N){return N===void 0&&(N=function(){return!0}),v(this,void 0,void 0,function(){return m(this,function(x){switch(x.label){case 0:return this.initializeFit(S),[4,this.optimizeLayoutAsync(N)];case 1:return x.sent(),[2,this.embedding]}})})},C.prototype.setSupervisedProjection=function(S,N){N===void 0&&(N={}),this.Y=S,this.targetMetric=N.targetMetric||this.targetMetric,this.targetWeight=N.targetWeight||this.targetWeight,this.targetNNeighbors=N.targetNNeighbors||this.targetNNeighbors},C.prototype.setPrecomputedKNN=function(S,N){this.knnIndices=S,this.knnDistances=N},C.prototype.initializeFit=function(S){if(S.length<=this.nNeighbors)throw new Error("Not enough data points ("+S.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===S&&this.isInitialized)return this.getNEpochs();if(this.X=S,!this.knnIndices&&!this.knnDistances){var N=this.nearestNeighbors(S);this.knnIndices=N.knnIndices,this.knnDistances=N.knnDistances}this.graph=this.fuzzySimplicialSet(S,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(S),this.processGraphForSupervisedProjection();var x=this.initializeSimplicialSetEmbedding(),G=x.head,B=x.tail,Q=x.epochsPerSample;return this.optimizationState.head=G,this.optimizationState.tail=B,this.optimizationState.epochsPerSample=Q,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},C.prototype.makeSearchFns=function(){var S=Y.makeInitializations(this.distanceFn),N=S.initFromTree,x=S.initFromRandom;this.initFromTree=N,this.initFromRandom=x,this.search=Y.makeInitializedNNSearch(this.distanceFn)},C.prototype.makeSearchGraph=function(S){for(var N=this.knnIndices,x=this.knnDistances,G=[S.length,S.length],B=new F.SparseMatrix([],[],[],G),Q=0;Q<N.length;Q++)for(var at=N[Q],mt=x[Q],tt=0;tt<at.length;tt++){var ct=at[tt],bt=mt[tt];bt>0&&B.set(Q,ct,bt)}var st=F.transpose(B);return F.maximum(B,st)},C.prototype.transform=function(S){var N=this,x=this.X;if(x===void 0||x.length===0)throw new Error("No data has been fit.");var G=Math.floor(this.nNeighbors*this.transformQueueSize);G=Math.min(x.length,G);var B=Y.initializeSearch(this.rpForest,x,S,G,this.initFromRandom,this.initFromTree,this.random),Q=this.search(x,this.searchGraph,B,S),at=K.deheapSort(Q),mt=at.indices,tt=at.weights;mt=mt.map(function(Jt){return Jt.slice(0,N.nNeighbors)}),tt=tt.map(function(Jt){return Jt.slice(0,N.nNeighbors)});var ct=Math.max(0,this.localConnectivity-1),bt=this.smoothKNNDistance(tt,this.nNeighbors,ct),st=bt.sigmas,It=bt.rhos,zt=this.computeMembershipStrengths(mt,tt,st,It),H=zt.rows,Bt=zt.cols,ie=zt.vals,$t=[S.length,x.length],qt=new F.SparseMatrix(H,Bt,ie,$t),Gt=F.normalize(qt,"l1"),At=F.getCSR(Gt),le=S.length,me=E.reshape2d(At.indices,le,this.nNeighbors),ue=E.reshape2d(At.values,le,this.nNeighbors),ce=X(me,ue,this.embedding),fe=this.nEpochs?this.nEpochs/3:qt.nRows<=1e4?100:30,ve=qt.getValues().reduce(function(Jt,ee){return ee>Jt?ee:Jt},0);qt=qt.map(function(Jt){return Jt<ve/fe?0:Jt}),qt=F.eliminateZeros(qt);var Xt=this.makeEpochsPerSample(qt.getValues(),fe),Yt=qt.getRows(),ye=qt.getCols();return this.assignOptimizationStateParameters({headEmbedding:ce,tailEmbedding:this.embedding,head:Yt,tail:ye,currentEpoch:0,nEpochs:fe,nVertices:qt.getDims()[1],epochsPerSample:Xt}),this.prepareForOptimizationLoop(),this.optimizeLayout()},C.prototype.processGraphForSupervisedProjection=function(){var S=this,N=S.Y,x=S.X;if(N){if(N.length!==x.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var G=this.targetWeight<1,B=G?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,N,B)}}},C.prototype.step=function(){var S=this.optimizationState.currentEpoch;return S<this.getNEpochs()&&this.optimizeLayoutStep(S),this.optimizationState.currentEpoch},C.prototype.getEmbedding=function(){return this.embedding},C.prototype.nearestNeighbors=function(S){var N=this,x=N.distanceFn,G=N.nNeighbors,B=function(zt){return Math.log(zt)/Math.log(2)},Q=Y.makeNNDescent(x,this.random),at=function(zt){return zt===.5?0:Math.round(zt)},mt=5+Math.floor(at(Math.pow(S.length,.5)/20)),tt=Math.max(5,Math.floor(Math.round(B(S.length))));this.rpForest=rt.makeForest(S,G,mt,this.random);var ct=rt.makeLeafArray(this.rpForest),bt=Q(S,ct,G,tt),st=bt.indices,It=bt.weights;return{knnIndices:st,knnDistances:It}},C.prototype.fuzzySimplicialSet=function(S,N,x){x===void 0&&(x=1);var G=this,B=G.knnIndices,Q=B===void 0?[]:B,at=G.knnDistances,mt=at===void 0?[]:at,tt=G.localConnectivity,ct=this.smoothKNNDistance(mt,N,tt),bt=ct.sigmas,st=ct.rhos,It=this.computeMembershipStrengths(Q,mt,bt,st),zt=It.rows,H=It.cols,Bt=It.vals,ie=[S.length,S.length],$t=new F.SparseMatrix(zt,H,Bt,ie),qt=F.transpose($t),Gt=F.pairwiseMultiply($t,qt),At=F.subtract(F.add($t,qt),Gt),le=F.multiplyScalar(At,x),me=F.multiplyScalar(Gt,1-x),ue=F.add(le,me);return ue},C.prototype.categoricalSimplicialSetIntersection=function(S,N,x,G){G===void 0&&(G=1);var B=O(S,N,G,x);return B=F.eliminateZeros(B),q(B)},C.prototype.smoothKNNDistance=function(S,N,x,G,B){x===void 0&&(x=1),G===void 0&&(G=64),B===void 0&&(B=1);for(var Q=Math.log(N)/Math.log(2)*B,at=E.zeros(S.length),mt=E.zeros(S.length),tt=0;tt<S.length;tt++){var ct=0,bt=1/0,st=1,It=S[tt],zt=It.filter(function(me){return me>0});if(zt.length>=x){var H=Math.floor(x),Bt=x-H;H>0?(at[tt]=zt[H-1],Bt>R&&(at[tt]+=Bt*(zt[H]-zt[H-1]))):at[tt]=Bt*zt[0]}else zt.length>0&&(at[tt]=E.max(zt));for(var ie=0;ie<G;ie++){for(var $t=0,qt=1;qt<S[tt].length;qt++){var Gt=S[tt][qt]-at[tt];Gt>0?$t+=Math.exp(-(Gt/st)):$t+=1}if(Math.abs($t-Q)<R)break;$t>Q?(bt=st,st=(ct+bt)/2):(ct=st,bt===1/0?st*=2:st=(ct+bt)/2)}if(mt[tt]=st,at[tt]>0){var At=E.mean(It);mt[tt]<j*At&&(mt[tt]=j*At)}else{var le=E.mean(S.map(E.mean));mt[tt]<j*le&&(mt[tt]=j*le)}}return{sigmas:mt,rhos:at}},C.prototype.computeMembershipStrengths=function(S,N,x,G){for(var B=S.length,Q=S[0].length,at=E.zeros(B*Q),mt=E.zeros(B*Q),tt=E.zeros(B*Q),ct=0;ct<B;ct++)for(var bt=0;bt<Q;bt++){var st=0;S[ct][bt]!==-1&&(S[ct][bt]===ct?st=0:N[ct][bt]-G[ct]<=0?st=1:st=Math.exp(-((N[ct][bt]-G[ct])/x[ct])),at[ct*Q+bt]=ct,mt[ct*Q+bt]=S[ct][bt],tt[ct*Q+bt]=st)}return{rows:at,cols:mt,vals:tt}},C.prototype.initializeSimplicialSetEmbedding=function(){for(var S=this,N=this.getNEpochs(),x=this.nComponents,G=this.graph.getValues(),B=0,Q=0;Q<G.length;Q++){var at=G[Q];B<G[Q]&&(B=at)}var mt=this.graph.map(function(H){return H<B/N?0:H});this.embedding=E.zeros(mt.nRows).map(function(){return E.zeros(x).map(function(){return E.tauRand(S.random)*20+-10})});for(var tt=[],ct=[],bt=[],st=mt.getAll(),Q=0;Q<st.length;Q++){var It=st[Q];It.value&&(tt.push(It.value),bt.push(It.row),ct.push(It.col))}var zt=this.makeEpochsPerSample(tt,N);return{head:ct,tail:bt,epochsPerSample:zt}},C.prototype.makeEpochsPerSample=function(S,N){var x=E.filled(S.length,-1),G=E.max(S),B=S.map(function(Q){return Q/G*N});return B.forEach(function(Q,at){Q>0&&(x[at]=N/B[at])}),x},C.prototype.assignOptimizationStateParameters=function(S){Object.assign(this.optimizationState,S)},C.prototype.prepareForOptimizationLoop=function(){var S=this,N=S.repulsionStrength,x=S.learningRate,G=S.negativeSampleRate,B=this.optimizationState,Q=B.epochsPerSample,at=B.headEmbedding,mt=B.tailEmbedding,tt=at[0].length,ct=at.length===mt.length,bt=Q.map(function(zt){return zt/G}),st=D(bt),It=D(Q);this.assignOptimizationStateParameters({epochOfNextSample:It,epochOfNextNegativeSample:st,epochsPerNegativeSample:bt,moveOther:ct,initialAlpha:x,alpha:x,gamma:N,dim:tt})},C.prototype.initializeOptimization=function(){var S=this.embedding,N=this.embedding,x=this.optimizationState,G=x.head,B=x.tail,Q=x.epochsPerSample,at=this.getNEpochs(),mt=this.graph.nCols,tt=d(this.spread,this.minDist),ct=tt.a,bt=tt.b;this.assignOptimizationStateParameters({headEmbedding:S,tailEmbedding:N,head:G,tail:B,epochsPerSample:Q,a:ct,b:bt,nEpochs:at,nVertices:mt})},C.prototype.optimizeLayoutStep=function(S){for(var N=this.optimizationState,x=N.head,G=N.tail,B=N.headEmbedding,Q=N.tailEmbedding,at=N.epochsPerSample,mt=N.epochOfNextSample,tt=N.epochOfNextNegativeSample,ct=N.epochsPerNegativeSample,bt=N.moveOther,st=N.initialAlpha,It=N.alpha,zt=N.gamma,H=N.a,Bt=N.b,ie=N.dim,$t=N.nEpochs,qt=N.nVertices,Gt=4,At=0;At<at.length;At++)if(!(mt[At]>S)){var le=x[At],me=G[At],ue=B[le],ce=Q[me],fe=w(ue,ce),ve=0;fe>0&&(ve=-2*H*Bt*Math.pow(fe,Bt-1),ve/=H*Math.pow(fe,Bt)+1);for(var Xt=0;Xt<ie;Xt++){var Yt=c(ve*(ue[Xt]-ce[Xt]),Gt);ue[Xt]+=Yt*It,bt&&(ce[Xt]+=-Yt*It)}mt[At]+=at[At];for(var ye=Math.floor((S-tt[At])/ct[At]),Jt=0;Jt<ye;Jt++){var ee=E.tauRandInt(qt,this.random),pe=Q[ee],he=w(ue,pe),de=0;if(he>0)de=2*zt*Bt,de/=(.001+he)*(H*Math.pow(he,Bt)+1);else if(le===ee)continue;for(var Xt=0;Xt<ie;Xt++){var Yt=4;de>0&&(Yt=c(de*(ue[Xt]-pe[Xt]),Gt)),ue[Xt]+=Yt*It}}tt[At]+=ye*ct[At]}return N.alpha=st*(1-S/$t),N.currentEpoch+=1,B},C.prototype.optimizeLayoutAsync=function(S){var N=this;return S===void 0&&(S=function(){return!0}),new Promise(function(x,G){var B=function(){return v(N,void 0,void 0,function(){var Q,at,mt,tt,ct,bt;return m(this,function(st){try{if(Q=this.optimizationState,at=Q.nEpochs,mt=Q.currentEpoch,this.embedding=this.optimizeLayoutStep(mt),tt=this.optimizationState.currentEpoch,ct=S(tt)===!1,bt=tt===at,!ct&&!bt)setTimeout(function(){return B()},0);else return[2,x(bt)]}catch(It){G(It)}return[2]})})};setTimeout(function(){return B()},0)})},C.prototype.optimizeLayout=function(S){S===void 0&&(S=function(){return!0});for(var N=!1,x=[];!N;){var G=this.optimizationState,B=G.nEpochs,Q=G.currentEpoch;x=this.optimizeLayoutStep(Q);var at=this.optimizationState.currentEpoch,mt=S(at)===!1;N=at===B||mt}return x},C.prototype.getNEpochs=function(){var S=this.graph;if(this.nEpochs>0)return this.nEpochs;var N=S.nRows;return N<=2500?500:N<=5e3?400:N<=7500?300:200},C})();Ct.UMAP=y;function I(C,S){for(var N=0,x=0;x<C.length;x++)N+=Math.pow(C[x]-S[x],2);return Math.sqrt(N)}Ct.euclidean=I;function P(C,S){for(var N=0,x=0,G=0,B=0;B<C.length;B++)N+=C[B]*S[B],x+=Math.pow(C[B],2),G+=Math.pow(S[B],2);return x===0&&G===0?0:x===0||G===0?1:1-N/Math.sqrt(x*G)}Ct.cosine=P;var M=(function(){function C(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return C})();function c(C,S){return C>S?S:C<-S?-S:C}function w(C,S){for(var N=0,x=0;x<C.length;x++)N+=Math.pow(C[x]-S[x],2);return N}function d(C,S){var N=function(st){var It=_(st,2),zt=It[0],H=It[1];return function(Bt){return 1/(1+zt*Math.pow(Bt,2*H))}},x=E.linear(0,C*3,300).map(function(st){return st<S?1:st}),G=E.zeros(x.length).map(function(st,It){var zt=x[It]>=S;return zt?Math.exp(-(x[It]-S)/C):st}),B=[.5,.5],Q={x,y:G},at={damping:1.5,initialValues:B,gradientDifference:.1,maxIterations:100,errorTolerance:.01},mt=L.default(Q,N,at).parameterValues,tt=_(mt,2),ct=tt[0],bt=tt[1];return{a:ct,b:bt}}Ct.findABParams=d;function O(C,S,N,x){return N===void 0&&(N=1),x===void 0&&(x=5),C.map(function(G,B,Q){return S[B]===-1||S[Q]===-1?G*Math.exp(-N):S[B]!==S[Q]?G*Math.exp(-x):G})}Ct.fastIntersection=O;function q(C){C=F.normalize(C,"max");var S=F.transpose(C),N=F.pairwiseMultiply(S,C);return C=F.add(C,F.subtract(S,N)),F.eliminateZeros(C)}Ct.resetLocalConnectivity=q;function X(C,S,N){for(var x=E.zeros(C.length).map(function(mt){return E.zeros(N[0].length)}),G=0;G<C.length;G++)for(var B=0;B<C[0].length;B++)for(var Q=0;Q<N[0].length;Q++){var at=C[G][B];x[G][Q]+=S[G][B]*N[at][Q]}return x}return Ct.initTransform=X,Ct}var Zr;function Ui(){return Zr||(Zr=1,(function(s){Object.defineProperty(s,"__esModule",{value:!0});var u=$i();Object.defineProperty(s,"UMAP",{enumerable:!0,get:function(){return u.UMAP}})})(_r)),_r}var Ai=Ui();function Yi(s,u){var g,v=1;s==null&&(s=0),u==null&&(u=0);function m(){var _,D=g.length,V,K=0,F=0;for(_=0;_<D;++_)V=g[_],K+=V.x,F+=V.y;for(K=(K/D-s)*v,F=(F/D-u)*v,_=0;_<D;++_)V=g[_],V.x-=K,V.y-=F}return m.initialize=function(_){g=_},m.x=function(_){return arguments.length?(s=+_,m):s},m.y=function(_){return arguments.length?(u=+_,m):u},m.strength=function(_){return arguments.length?(v=+_,m):v},m}function Wi(s){const u=+this._x.call(null,s),g=+this._y.call(null,s);return gn(this.cover(u,g),u,g,s)}function gn(s,u,g,v){if(isNaN(u)||isNaN(g))return s;var m,_=s._root,D={data:v},V=s._x0,K=s._y0,F=s._x1,Y=s._y1,rt,E,L,R,j,y,I,P;if(!_)return s._root=D,s;for(;_.length;)if((j=u>=(rt=(V+F)/2))?V=rt:F=rt,(y=g>=(E=(K+Y)/2))?K=E:Y=E,m=_,!(_=_[I=y<<1|j]))return m[I]=D,s;if(L=+s._x.call(null,_.data),R=+s._y.call(null,_.data),u===L&&g===R)return D.next=_,m?m[I]=D:s._root=D,s;do m=m?m[I]=new Array(4):s._root=new Array(4),(j=u>=(rt=(V+F)/2))?V=rt:F=rt,(y=g>=(E=(K+Y)/2))?K=E:Y=E;while((I=y<<1|j)===(P=(R>=E)<<1|L>=rt));return m[P]=_,m[I]=D,s}function Ki(s){var u,g,v=s.length,m,_,D=new Array(v),V=new Array(v),K=1/0,F=1/0,Y=-1/0,rt=-1/0;for(g=0;g<v;++g)isNaN(m=+this._x.call(null,u=s[g]))||isNaN(_=+this._y.call(null,u))||(D[g]=m,V[g]=_,m<K&&(K=m),m>Y&&(Y=m),_<F&&(F=_),_>rt&&(rt=_));if(K>Y||F>rt)return this;for(this.cover(K,F).cover(Y,rt),g=0;g<v;++g)gn(this,D[g],V[g],s[g]);return this}function Qi(s,u){if(isNaN(s=+s)||isNaN(u=+u))return this;var g=this._x0,v=this._y0,m=this._x1,_=this._y1;if(isNaN(g))m=(g=Math.floor(s))+1,_=(v=Math.floor(u))+1;else{for(var D=m-g||1,V=this._root,K,F;g>s||s>=m||v>u||u>=_;)switch(F=(u<v)<<1|s<g,K=new Array(4),K[F]=V,V=K,D*=2,F){case 0:m=g+D,_=v+D;break;case 1:g=m-D,_=v+D;break;case 2:m=g+D,v=_-D;break;case 3:g=m-D,v=_-D;break}this._root&&this._root.length&&(this._root=V)}return this._x0=g,this._y0=v,this._x1=m,this._y1=_,this}function Xi(){var s=[];return this.visit(function(u){if(!u.length)do s.push(u.data);while(u=u.next)}),s}function Gi(s){return arguments.length?this.cover(+s[0][0],+s[0][1]).cover(+s[1][0],+s[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function oe(s,u,g,v,m){this.node=s,this.x0=u,this.y0=g,this.x1=v,this.y1=m}function Ji(s,u,g){var v,m=this._x0,_=this._y0,D,V,K,F,Y=this._x1,rt=this._y1,E=[],L=this._root,R,j;for(L&&E.push(new oe(L,m,_,Y,rt)),g==null?g=1/0:(m=s-g,_=u-g,Y=s+g,rt=u+g,g*=g);R=E.pop();)if(!(!(L=R.node)||(D=R.x0)>Y||(V=R.y0)>rt||(K=R.x1)<m||(F=R.y1)<_))if(L.length){var y=(D+K)/2,I=(V+F)/2;E.push(new oe(L[3],y,I,K,F),new oe(L[2],D,I,y,F),new oe(L[1],y,V,K,I),new oe(L[0],D,V,y,I)),(j=(u>=I)<<1|s>=y)&&(R=E[E.length-1],E[E.length-1]=E[E.length-1-j],E[E.length-1-j]=R)}else{var P=s-+this._x.call(null,L.data),M=u-+this._y.call(null,L.data),c=P*P+M*M;if(c<g){var w=Math.sqrt(g=c);m=s-w,_=u-w,Y=s+w,rt=u+w,v=L.data}}return v}function Zi(s){if(isNaN(Y=+this._x.call(null,s))||isNaN(rt=+this._y.call(null,s)))return this;var u,g=this._root,v,m,_,D=this._x0,V=this._y0,K=this._x1,F=this._y1,Y,rt,E,L,R,j,y,I;if(!g)return this;if(g.length)for(;;){if((R=Y>=(E=(D+K)/2))?D=E:K=E,(j=rt>=(L=(V+F)/2))?V=L:F=L,u=g,!(g=g[y=j<<1|R]))return this;if(!g.length)break;(u[y+1&3]||u[y+2&3]||u[y+3&3])&&(v=u,I=y)}for(;g.data!==s;)if(m=g,!(g=g.next))return this;return(_=g.next)&&delete g.next,m?(_?m.next=_:delete m.next,this):u?(_?u[y]=_:delete u[y],(g=u[0]||u[1]||u[2]||u[3])&&g===(u[3]||u[2]||u[1]||u[0])&&!g.length&&(v?v[I]=g:this._root=g),this):(this._root=_,this)}function Hi(s){for(var u=0,g=s.length;u<g;++u)this.remove(s[u]);return this}function ts(){return this._root}function es(){var s=0;return this.visit(function(u){if(!u.length)do++s;while(u=u.next)}),s}function rs(s){var u=[],g,v=this._root,m,_,D,V,K;for(v&&u.push(new oe(v,this._x0,this._y0,this._x1,this._y1));g=u.pop();)if(!s(v=g.node,_=g.x0,D=g.y0,V=g.x1,K=g.y1)&&v.length){var F=(_+V)/2,Y=(D+K)/2;(m=v[3])&&u.push(new oe(m,F,Y,V,K)),(m=v[2])&&u.push(new oe(m,_,Y,F,K)),(m=v[1])&&u.push(new oe(m,F,D,V,Y)),(m=v[0])&&u.push(new oe(m,_,D,F,Y))}return this}function ns(s){var u=[],g=[],v;for(this._root&&u.push(new oe(this._root,this._x0,this._y0,this._x1,this._y1));v=u.pop();){var m=v.node;if(m.length){var _,D=v.x0,V=v.y0,K=v.x1,F=v.y1,Y=(D+K)/2,rt=(V+F)/2;(_=m[0])&&u.push(new oe(_,D,V,Y,rt)),(_=m[1])&&u.push(new oe(_,Y,V,K,rt)),(_=m[2])&&u.push(new oe(_,D,rt,Y,F)),(_=m[3])&&u.push(new oe(_,Y,rt,K,F))}g.push(v)}for(;v=g.pop();)s(v.node,v.x0,v.y0,v.x1,v.y1);return this}function is(s){return s[0]}function ss(s){return arguments.length?(this._x=s,this):this._x}function os(s){return s[1]}function as(s){return arguments.length?(this._y=s,this):this._y}function Tr(s,u,g){var v=new zr(u??is,g??os,NaN,NaN,NaN,NaN);return s==null?v:v.addAll(s)}function zr(s,u,g,v,m,_){this._x=s,this._y=u,this._x0=g,this._y0=v,this._x1=m,this._y1=_,this._root=void 0}function Hr(s){for(var u={data:s.data},g=u;s=s.next;)g=g.next={data:s.data};return u}var ae=Tr.prototype=zr.prototype;ae.copy=function(){var s=new zr(this._x,this._y,this._x0,this._y0,this._x1,this._y1),u=this._root,g,v;if(!u)return s;if(!u.length)return s._root=Hr(u),s;for(g=[{source:u,target:s._root=new Array(4)}];u=g.pop();)for(var m=0;m<4;++m)(v=u.source[m])&&(v.length?g.push({source:v,target:u.target[m]=new Array(4)}):u.target[m]=Hr(v));return s};ae.add=Wi;ae.addAll=Ki;ae.cover=Qi;ae.data=Xi;ae.extent=Gi;ae.find=Ji;ae.remove=Zi;ae.removeAll=Hi;ae.root=ts;ae.size=es;ae.visit=rs;ae.visitAfter=ns;ae.x=ss;ae.y=as;function xe(s){return function(){return s}}function Se(s){return(s()-.5)*1e-6}function ls(s){return s.x+s.vx}function us(s){return s.y+s.vy}function hs(s){var u,g,v,m=1,_=1;typeof s!="function"&&(s=xe(s==null?1:+s));function D(){for(var F,Y=u.length,rt,E,L,R,j,y,I=0;I<_;++I)for(rt=Tr(u,ls,us).visitAfter(V),F=0;F<Y;++F)E=u[F],j=g[E.index],y=j*j,L=E.x+E.vx,R=E.y+E.vy,rt.visit(P);function P(M,c,w,d,O){var q=M.data,X=M.r,C=j+X;if(q){if(q.index>E.index){var S=L-q.x-q.vx,N=R-q.y-q.vy,x=S*S+N*N;x<C*C&&(S===0&&(S=Se(v),x+=S*S),N===0&&(N=Se(v),x+=N*N),x=(C-(x=Math.sqrt(x)))/x*m,E.vx+=(S*=x)*(C=(X*=X)/(y+X)),E.vy+=(N*=x)*C,q.vx-=S*(C=1-C),q.vy-=N*C)}return}return c>L+C||d<L-C||w>R+C||O<R-C}}function V(F){if(F.data)return F.r=g[F.data.index];for(var Y=F.r=0;Y<4;++Y)F[Y]&&F[Y].r>F.r&&(F.r=F[Y].r)}function K(){if(u){var F,Y=u.length,rt;for(g=new Array(Y),F=0;F<Y;++F)rt=u[F],g[rt.index]=+s(rt,F,u)}}return D.initialize=function(F,Y){u=F,v=Y,K()},D.iterations=function(F){return arguments.length?(_=+F,D):_},D.strength=function(F){return arguments.length?(m=+F,D):m},D.radius=function(F){return arguments.length?(s=typeof F=="function"?F:xe(+F),K(),D):s},D}function fs(s){return s.index}function tn(s,u){var g=s.get(u);if(!g)throw new Error("node not found: "+u);return g}function cs(s){var u=fs,g=rt,v,m=xe(30),_,D,V,K,F,Y=1;s==null&&(s=[]);function rt(y){return 1/Math.min(V[y.source.index],V[y.target.index])}function E(y){for(var I=0,P=s.length;I<Y;++I)for(var M=0,c,w,d,O,q,X,C;M<P;++M)c=s[M],w=c.source,d=c.target,O=d.x+d.vx-w.x-w.vx||Se(F),q=d.y+d.vy-w.y-w.vy||Se(F),X=Math.sqrt(O*O+q*q),X=(X-_[M])/X*y*v[M],O*=X,q*=X,d.vx-=O*(C=K[M]),d.vy-=q*C,w.vx+=O*(C=1-C),w.vy+=q*C}function L(){if(D){var y,I=D.length,P=s.length,M=new Map(D.map((w,d)=>[u(w,d,D),w])),c;for(y=0,V=new Array(I);y<P;++y)c=s[y],c.index=y,typeof c.source!="object"&&(c.source=tn(M,c.source)),typeof c.target!="object"&&(c.target=tn(M,c.target)),V[c.source.index]=(V[c.source.index]||0)+1,V[c.target.index]=(V[c.target.index]||0)+1;for(y=0,K=new Array(P);y<P;++y)c=s[y],K[y]=V[c.source.index]/(V[c.source.index]+V[c.target.index]);v=new Array(P),R(),_=new Array(P),j()}}function R(){if(D)for(var y=0,I=s.length;y<I;++y)v[y]=+g(s[y],y,s)}function j(){if(D)for(var y=0,I=s.length;y<I;++y)_[y]=+m(s[y],y,s)}return E.initialize=function(y,I){D=y,F=I,L()},E.links=function(y){return arguments.length?(s=y,L(),E):s},E.id=function(y){return arguments.length?(u=y,E):u},E.iterations=function(y){return arguments.length?(Y=+y,E):Y},E.strength=function(y){return arguments.length?(g=typeof y=="function"?y:xe(+y),R(),E):g},E.distance=function(y){return arguments.length?(m=typeof y=="function"?y:xe(+y),j(),E):m},E}var gs={value:()=>{}};function mn(){for(var s=0,u=arguments.length,g={},v;s<u;++s){if(!(v=arguments[s]+"")||v in g||/[\s.]/.test(v))throw new Error("illegal type: "+v);g[v]=[]}return new sr(g)}function sr(s){this._=s}function ms(s,u){return s.trim().split(/^|\s+/).map(function(g){var v="",m=g.indexOf(".");if(m>=0&&(v=g.slice(m+1),g=g.slice(0,m)),g&&!u.hasOwnProperty(g))throw new Error("unknown type: "+g);return{type:g,name:v}})}sr.prototype=mn.prototype={constructor:sr,on:function(s,u){var g=this._,v=ms(s+"",g),m,_=-1,D=v.length;if(arguments.length<2){for(;++_<D;)if((m=(s=v[_]).type)&&(m=vs(g[m],s.name)))return m;return}if(u!=null&&typeof u!="function")throw new Error("invalid callback: "+u);for(;++_<D;)if(m=(s=v[_]).type)g[m]=en(g[m],s.name,u);else if(u==null)for(m in g)g[m]=en(g[m],s.name,null);return this},copy:function(){var s={},u=this._;for(var g in u)s[g]=u[g].slice();return new sr(s)},call:function(s,u){if((m=arguments.length-2)>0)for(var g=new Array(m),v=0,m,_;v<m;++v)g[v]=arguments[v+2];if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(_=this._[s],v=0,m=_.length;v<m;++v)_[v].value.apply(u,g)},apply:function(s,u,g){if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(var v=this._[s],m=0,_=v.length;m<_;++m)v[m].value.apply(u,g)}};function vs(s,u){for(var g=0,v=s.length,m;g<v;++g)if((m=s[g]).name===u)return m.value}function en(s,u,g){for(var v=0,m=s.length;v<m;++v)if(s[v].name===u){s[v]=gs,s=s.slice(0,v).concat(s.slice(v+1));break}return g!=null&&s.push({name:u,value:g}),s}var ze=0,Ae=0,Be=0,vn=1e3,ar,Ye,lr=0,je=0,hr=0,Qe=typeof performance=="object"&&performance.now?performance:Date,pn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(s){setTimeout(s,17)};function dn(){return je||(pn(ps),je=Qe.now()+hr)}function ps(){je=0}function jr(){this._call=this._time=this._next=null}jr.prototype=wn.prototype={constructor:jr,restart:function(s,u,g){if(typeof s!="function")throw new TypeError("callback is not a function");g=(g==null?dn():+g)+(u==null?0:+u),!this._next&&Ye!==this&&(Ye?Ye._next=this:ar=this,Ye=this),this._call=s,this._time=g,kr()},stop:function(){this._call&&(this._call=null,this._time=1/0,kr())}};function wn(s,u,g){var v=new jr;return v.restart(s,u,g),v}function ds(){dn(),++ze;for(var s=ar,u;s;)(u=je-s._time)>=0&&s._call.call(void 0,u),s=s._next;--ze}function rn(){je=(lr=Qe.now())+hr,ze=Ae=0;try{ds()}finally{ze=0,ys(),je=0}}function ws(){var s=Qe.now(),u=s-lr;u>vn&&(hr-=u,lr=s)}function ys(){for(var s,u=ar,g,v=1/0;u;)u._call?(v>u._time&&(v=u._time),s=u,u=u._next):(g=u._next,u._next=null,u=s?s._next=g:ar=g);Ye=s,kr(v)}function kr(s){if(!ze){Ae&&(Ae=clearTimeout(Ae));var u=s-je;u>24?(s<1/0&&(Ae=setTimeout(rn,s-Qe.now()-hr)),Be&&(Be=clearInterval(Be))):(Be||(lr=Qe.now(),Be=setInterval(ws,vn)),ze=1,pn(rn))}}const bs=1664525,_s=1013904223,nn=4294967296;function Ss(){let s=1;return()=>(s=(bs*s+_s)%nn)/nn}function Ms(s){return s.x}function Es(s){return s.y}var Ns=10,xs=Math.PI*(3-Math.sqrt(5));function js(s){var u,g=1,v=.001,m=1-Math.pow(v,1/300),_=0,D=.6,V=new Map,K=wn(rt),F=mn("tick","end"),Y=Ss();s==null&&(s=[]);function rt(){E(),F.call("tick",u),g<v&&(K.stop(),F.call("end",u))}function E(j){var y,I=s.length,P;j===void 0&&(j=1);for(var M=0;M<j;++M)for(g+=(_-g)*m,V.forEach(function(c){c(g)}),y=0;y<I;++y)P=s[y],P.fx==null?P.x+=P.vx*=D:(P.x=P.fx,P.vx=0),P.fy==null?P.y+=P.vy*=D:(P.y=P.fy,P.vy=0);return u}function L(){for(var j=0,y=s.length,I;j<y;++j){if(I=s[j],I.index=j,I.fx!=null&&(I.x=I.fx),I.fy!=null&&(I.y=I.fy),isNaN(I.x)||isNaN(I.y)){var P=Ns*Math.sqrt(.5+j),M=j*xs;I.x=P*Math.cos(M),I.y=P*Math.sin(M)}(isNaN(I.vx)||isNaN(I.vy))&&(I.vx=I.vy=0)}}function R(j){return j.initialize&&j.initialize(s,Y),j}return L(),u={tick:E,restart:function(){return K.restart(rt),u},stop:function(){return K.stop(),u},nodes:function(j){return arguments.length?(s=j,L(),V.forEach(R),u):s},alpha:function(j){return arguments.length?(g=+j,u):g},alphaMin:function(j){return arguments.length?(v=+j,u):v},alphaDecay:function(j){return arguments.length?(m=+j,u):+m},alphaTarget:function(j){return arguments.length?(_=+j,u):_},velocityDecay:function(j){return arguments.length?(D=1-j,u):1-D},randomSource:function(j){return arguments.length?(Y=j,V.forEach(R),u):Y},force:function(j,y){return arguments.length>1?(y==null?V.delete(j):V.set(j,R(y)),u):V.get(j)},find:function(j,y,I){var P=0,M=s.length,c,w,d,O,q;for(I==null?I=1/0:I*=I,P=0;P<M;++P)O=s[P],c=j-O.x,w=y-O.y,d=c*c+w*w,d<I&&(q=O,I=d);return q},on:function(j,y){return arguments.length>1?(F.on(j,y),u):F.on(j)}}}function ks(){var s,u,g,v,m=xe(-30),_,D=1,V=1/0,K=.81;function F(L){var R,j=s.length,y=Tr(s,Ms,Es).visitAfter(rt);for(v=L,R=0;R<j;++R)u=s[R],y.visit(E)}function Y(){if(s){var L,R=s.length,j;for(_=new Array(R),L=0;L<R;++L)j=s[L],_[j.index]=+m(j,L,s)}}function rt(L){var R=0,j,y,I=0,P,M,c;if(L.length){for(P=M=c=0;c<4;++c)(j=L[c])&&(y=Math.abs(j.value))&&(R+=j.value,I+=y,P+=y*j.x,M+=y*j.y);L.x=P/I,L.y=M/I}else{j=L,j.x=j.data.x,j.y=j.data.y;do R+=_[j.data.index];while(j=j.next)}L.value=R}function E(L,R,j,y){if(!L.value)return!0;var I=L.x-u.x,P=L.y-u.y,M=y-R,c=I*I+P*P;if(M*M/K<c)return c<V&&(I===0&&(I=Se(g),c+=I*I),P===0&&(P=Se(g),c+=P*P),c<D&&(c=Math.sqrt(D*c)),u.vx+=I*L.value*v/c,u.vy+=P*L.value*v/c),!0;if(L.length||c>=V)return;(L.data!==u||L.next)&&(I===0&&(I=Se(g),c+=I*I),P===0&&(P=Se(g),c+=P*P),c<D&&(c=Math.sqrt(D*c)));do L.data!==u&&(M=_[L.data.index]*v/c,u.vx+=I*M,u.vy+=P*M);while(L=L.next)}return F.initialize=function(L,R){s=L,g=R,Y()},F.strength=function(L){return arguments.length?(m=typeof L=="function"?L:xe(+L),Y(),F):m},F.distanceMin=function(L){return arguments.length?(D=L*L,F):Math.sqrt(D)},F.distanceMax=function(L){return arguments.length?(V=L*L,F):Math.sqrt(V)},F.theta=function(L){return arguments.length?(K=L*L,F):Math.sqrt(K)},F}var Rs=Pe('<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"><circle cx="8" cy="8" r="3.5"></circle><line x1="8" y1="1" x2="8" y2="3"></line><line x1="8" y1="13" x2="8" y2="15"></line><line x1="1" y1="8" x2="3" y2="8"></line><line x1="13" y1="8" x2="15" y2="8"></line><line x1="3.05" y1="3.05" x2="4.46" y2="4.46"></line><line x1="11.54" y1="11.54" x2="12.95" y2="12.95"></line><line x1="3.05" y1="12.95" x2="4.46" y2="11.54"></line><line x1="11.54" y1="4.46" x2="12.95" y2="3.05"></line></svg>'),Is=Pe('<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"><path d="M13.5 9.5a5.5 5.5 0 01-7-7 5.5 5.5 0 107 7z"></path></svg>'),Ts=Pe('<svg class="status-icon good svelte-1uha8ag" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 7.5 5.5 10 11 4"></polyline></svg>'),zs=Pe('<svg class="status-icon faded svelte-1uha8ag" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="7" cy="7" r="5"></circle></svg>'),Ps=ne('<div class="info-item svelte-1uha8ag"><!> <span class="info-value svelte-1uha8ag"> </span></div>'),Os=Pe('<rect x="2" y="1" width="12" height="14" rx="1.5"></rect><line x1="5" y1="5" x2="11" y2="5"></line><line x1="5" y1="8" x2="9" y2="8"></line><line x1="5" y1="11" x2="11" y2="11"></line>',1),Fs=Pe('<path d="M3 1.5h7l3 3v10a1 1 0 01-1 1H3a1 1 0 01-1-1v-13a1 1 0 011-1z"></path><path d="M10 1.5v3h3"></path>',1),Cs=ne('<button><svg class="file-icon svelte-1uha8ag" width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><!></svg> <span class="file-name svelte-1uha8ag"> </span> <span class="file-size svelte-1uha8ag"> </span></button>'),Ds=ne('<span class="save-indicator svelte-1uha8ag">saved</span>'),Ls=ne('<div class="tab-title svelte-1uha8ag"> </div> <div class="tab-actions svelte-1uha8ag"><!> <button class="action-btn svelte-1uha8ag"> </button></div>',1),qs=ne('<div class="tab-title svelte-1uha8ag">memory space</div> <div class="tab-info svelte-1uha8ag"> </div>',1),Vs=ne('<div class="loading-overlay svelte-1uha8ag"><p> </p></div>'),Bs=ne('<div class="loading-overlay svelte-1uha8ag"><p class="error-text svelte-1uha8ag"> </p></div>'),$s=ne('<div class="loading-overlay svelte-1uha8ag"><p>No embeddings found</p> <p class="sub svelte-1uha8ag">Save some memories first</p></div>'),Us=ne('<div class="loading-overlay svelte-1uha8ag"><p>Switch to this tab to load the graph</p></div>'),As=ne('<span> </span> <span class="status-right svelte-1uha8ag"><kbd class="svelte-1uha8ag">Ctrl+S</kbd> save</span>',1),Ys=ne('<span> </span> <span class="status-right svelte-1uha8ag">UMAP + d3-force</span>',1),Ws=ne('<button class="clear-btn svelte-1uha8ag">clear</button>'),Ks=ne('<div class="search-status svelte-1uha8ag"> </div>'),Qs=ne('<span class="memory-badge svelte-1uha8ag">critical</span>'),Xs=ne('<div class="memory-card svelte-1uha8ag"><p class="memory-text svelte-1uha8ag"> </p> <div class="memory-meta svelte-1uha8ag"><span class="memory-who svelte-1uha8ag"> </span> <!> <span class="memory-date svelte-1uha8ag"> </span></div></div>'),Gs=ne('<div class="empty-state svelte-1uha8ag"> </div>'),Js=ne('<div class="dashboard svelte-1uha8ag"><header class="header svelte-1uha8ag"><div class="header-left svelte-1uha8ag"><svg class="logo-icon svelte-1uha8ag" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 1L14.5 8L8 15L1.5 8Z" stroke="currentColor" stroke-width="1.1"></path><circle cx="8" cy="8" r="1.8" fill="currentColor"></circle></svg> <span class="logo-text svelte-1uha8ag">signet</span></div> <button class="theme-btn svelte-1uha8ag" aria-label="Toggle theme"><!></button></header> <div class="body svelte-1uha8ag"><aside class="left-sidebar svelte-1uha8ag"><div class="sidebar-group-title svelte-1uha8ag">Agent</div> <div class="sidebar-label svelte-1uha8ag">Identity</div> <div class="info-list svelte-1uha8ag"><div class="info-item svelte-1uha8ag"><span class="info-label svelte-1uha8ag">name</span> <span class="info-value svelte-1uha8ag"> </span></div> <div class="info-item svelte-1uha8ag"><span class="info-label svelte-1uha8ag">creature</span> <span class="info-value svelte-1uha8ag"> </span></div> <div class="info-item svelte-1uha8ag"><span class="info-label svelte-1uha8ag">memories</span> <span class="info-value accent svelte-1uha8ag"> </span></div></div> <div class="sidebar-label svelte-1uha8ag">Harnesses</div> <div class="info-list svelte-1uha8ag"></div> <div class="sidebar-label svelte-1uha8ag">Config Files</div> <div class="file-list svelte-1uha8ag"></div></aside> <div class="center-panel svelte-1uha8ag"><div class="tab-bar svelte-1uha8ag"><button><svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M3 1.5h7l3 3v10a1 1 0 01-1 1H3a1 1 0 01-1-1v-13a1 1 0 011-1z"></path><path d="M10 1.5v3h3"></path></svg> <span>Config</span></button> <button><svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><circle cx="4" cy="5" r="1.5"></circle><circle cx="11" cy="4" r="1.5"></circle><circle cx="7" cy="10" r="1.5"></circle><circle cx="13" cy="11" r="1.5"></circle><line x1="5.2" y1="5.8" x2="5.8" y2="9" opacity="0.4"></line><line x1="8.5" y1="10" x2="11.5" y2="11" opacity="0.4"></line><line x1="9.5" y1="4.5" x2="8.2" y2="8.8" opacity="0.4"></line></svg> <span>Embeddings</span></button> <div class="tab-spacer svelte-1uha8ag"></div> <!></div> <div class="panel-content svelte-1uha8ag"><textarea class="editor-textarea svelte-1uha8ag" spellcheck="false" placeholder="Empty file..."></textarea></div> <div class="panel-content svelte-1uha8ag"><div class="canvas-area svelte-1uha8ag"><!> <canvas class="graph-canvas svelte-1uha8ag" style="cursor: grab;"></canvas></div></div> <div class="status-bar svelte-1uha8ag"><!></div></div> <aside class="right-sidebar svelte-1uha8ag"><div class="sidebar-group-title svelte-1uha8ag"><span>Memories</span> <span class="memory-count svelte-1uha8ag"> </span></div> <div class="memory-search-box svelte-1uha8ag"><input type="text" placeholder="Search memories..." class="memory-search-input svelte-1uha8ag"/> <!></div> <!> <div class="memory-list svelte-1uha8ag"></div></aside></div></div>');function ro(s,u){Jn(u,!0);let g=Zt("dark");{const T=document.documentElement.dataset.theme;kt(g,T==="light"||T==="dark"?T:"dark",!0)}function v(){kt(g,Z(g)==="dark"?"light":"dark",!0),document.documentElement.dataset.theme=Z(g),localStorage.setItem("signet-theme",Z(g))}let m=Zt("config"),_=Zt(""),D=Zt(""),V=Zt(!1),K=Zt(!1);tr(()=>{!Z(_)&&u.data.configFiles?.length&&kt(_,u.data.configFiles[0].name,!0)}),tr(()=>{const T=u.data.configFiles?.find(A=>A.name===Z(_));kt(D,T?.content??"",!0),kt(K,!1)});function F(T){kt(_,T,!0),kt(m,"config")}function Y(T){return T.split(".").pop()??""}function rt(T){return T<1024?`${T} B`:`${(T/1024).toFixed(1)} KB`}async function E(){kt(V,!0),kt(K,!1);try{(await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:Z(_),content:Z(D)})})).ok&&(kt(K,!0),setTimeout(()=>kt(K,!1),2e3))}finally{kt(V,!1)}}function L(T){(T.metaKey||T.ctrlKey)&&T.key==="s"&&(T.preventDefault(),E())}let R=Zt(null),j=Zt(null),y=Zt(null),I=Zt(""),P=Zt(""),M=Zt(er([])),c=Zt(!1);const w={"claude-code":"#5eada4",clawdbot:"#a78bfa",openclaw:"#4ade80",opencode:"#60a5fa",manual:"#f472b6",unknown:"#737373"};let d=0,O=0,q=1,X=!1,C=!1,S=null,N=0,x=0,G=0,B=0,Q=Zt(er([])),at=Zt(er([])),mt=null,tt=0;function ct(T){const A=parseInt(T.slice(1),16);return[A>>16&255,A>>8&255,A&255]}function bt(T,A){const ot=new Set,ft=[];for(let gt=0;gt<T.length;gt++){const Nt=[];for(let dt=0;dt<T.length;dt++){if(gt===dt)continue;const vt=T[gt][0]-T[dt][0],St=T[gt][1]-T[dt][1];Nt.push({j:dt,d:vt*vt+St*St})}Nt.sort((dt,vt)=>dt.d-vt.d);for(let dt=0;dt<Math.min(A,Nt.length);dt++){const vt=Math.min(gt,Nt[dt].j),St=Math.max(gt,Nt[dt].j),pt=`${vt}-${St}`;ot.has(pt)||(ot.add(pt),ft.push([vt,St]))}}return ft}function st(T,A){const ot=Z(R).getBoundingClientRect(),ft=ot.width/2,gt=ot.height/2;return[(T-ot.left-ft)/q+d,(A-ot.top-gt)/q+O]}function It(T,A){for(let ot=Z(Q).length-1;ot>=0;ot--){const ft=Z(Q)[ot],gt=ft.x-T,Nt=ft.y-A,dt=ft.radius+4;if(gt*gt+Nt*Nt<=dt*dt)return ft}return null}function zt(T){const A=Z(R).width,ot=Z(R).height;T.clearRect(0,0,A,ot),T.save(),T.translate(A/2,ot/2),T.scale(q,q),T.translate(-d,-O);for(const vt of Z(at)){const St=vt.source,pt=vt.target,[Rt,Lt,Pt]=ct(St.color),[Mt,re,Ee]=ct(pt.color);T.beginPath(),T.moveTo(St.x,St.y),T.lineTo(pt.x,pt.y),T.strokeStyle=`rgba(${Rt+Mt>>1},${Lt+re>>1},${Pt+Ee>>1},0.12)`,T.lineWidth=1,T.stroke()}tt+=.015;const ft=.6+.4*Math.sin(tt);for(const vt of Z(Q)){const[St,pt,Rt]=ct(vt.color),Lt=vt.radius*(2.5+.5*ft),Pt=T.createRadialGradient(vt.x,vt.y,vt.radius*.5,vt.x,vt.y,Lt);Pt.addColorStop(0,`rgba(${St},${pt},${Rt},${.25*ft})`),Pt.addColorStop(1,`rgba(${St},${pt},${Rt},0)`),T.beginPath(),T.arc(vt.x,vt.y,Lt,0,Math.PI*2),T.fillStyle=Pt,T.fill(),T.beginPath(),T.arc(vt.x,vt.y,vt.radius,0,Math.PI*2),T.fillStyle=vt.color,T.fill(),Z(j)&&vt.data===Z(j)&&(T.beginPath(),T.arc(vt.x,vt.y,vt.radius+4,0,Math.PI*2),T.strokeStyle="#5eada4",T.lineWidth=2,T.stroke())}if(Z(y)){const vt=Z(Q).find(St=>St.data===Z(y));if(vt){const St=(Z(y).text||"").slice(0,60)+(Z(y).text?.length>60?"...":"");T.font=`${11/q}px ui-monospace, monospace`;const pt=T.measureText(St),Rt=4/q,Lt=vt.x-pt.width/2-Rt,Pt=vt.y-vt.radius-20/q;T.fillStyle="rgba(20, 20, 20, 0.85)",T.beginPath(),T.roundRect(Lt,Pt-12/q,pt.width+Rt*2,16/q,3/q),T.fill(),T.fillStyle="#d4d4d4",T.textAlign="center",T.fillText(St,vt.x,Pt),T.textAlign="start"}}T.restore();const gt=Object.entries(w).filter(([vt])=>vt!=="unknown"),Nt=16;let dt=ot-16-gt.length*18;T.fillStyle="rgba(15, 15, 15, 0.75)",T.beginPath(),T.roundRect(Nt-8,dt-14,120,gt.length*18+12,6),T.fill(),T.font="11px ui-monospace, monospace";for(const[vt,St]of gt){const[pt,Rt,Lt]=ct(St),Pt=T.createRadialGradient(Nt+4,dt,1,Nt+4,dt,6);Pt.addColorStop(0,`rgba(${pt},${Rt},${Lt},0.8)`),Pt.addColorStop(1,`rgba(${pt},${Rt},${Lt},0)`),T.beginPath(),T.arc(Nt+4,dt,6,0,Math.PI*2),T.fillStyle=Pt,T.fill(),T.beginPath(),T.arc(Nt+4,dt,3,0,Math.PI*2),T.fillStyle=St,T.fill(),T.fillStyle="#999",T.fillText(vt,Nt+16,dt+4),dt+=18}requestAnimationFrame(()=>zt(T))}function H(){if(!Z(R))return;Z(R).addEventListener("pointerdown",A=>{const[ot,ft]=st(A.clientX,A.clientY),gt=It(ot,ft);gt?(C=!0,S=gt,gt.fx=gt.x,gt.fy=gt.y,mt?.alphaTarget(.3).restart()):(X=!0,N=A.clientX,x=A.clientY,G=d,B=O)}),Z(R).addEventListener("pointermove",A=>{if(C&&S){const[Nt,dt]=st(A.clientX,A.clientY);S.fx=Nt,S.fy=dt;return}if(X){d=G-(A.clientX-N)/q,O=B-(A.clientY-x)/q;return}const[ot,ft]=st(A.clientX,A.clientY),gt=It(ot,ft);kt(y,gt?.data||null,!0),Z(R).style.cursor=gt?"pointer":"grab"});const T=()=>{if(C&&S){S.fx=null,S.fy=null,mt?.alphaTarget(0),S=null,C=!1;return}X=!1};Z(R).addEventListener("pointerup",T),Z(R).addEventListener("pointerleave",T),Z(R).addEventListener("click",A=>{if(C)return;const[ot,ft]=st(A.clientX,A.clientY),gt=It(ot,ft);kt(j,gt?.data||null,!0)}),Z(R).addEventListener("wheel",A=>{A.preventDefault();const ot=A.deltaY>0?.9:1.1,ft=Math.max(.1,Math.min(5,q*ot)),gt=Z(R).getBoundingClientRect(),Nt=gt.width/2,dt=gt.height/2,vt=A.clientX-gt.left-Nt,St=A.clientY-gt.top-dt,pt=vt/q+d,Rt=St/q+O;q=ft,d=pt-vt/q,O=Rt-St/q},{passive:!1})}function Bt(){if(!Z(R))return;const T=Z(R).parentElement.getBoundingClientRect();Z(R).width=T.width,Z(R).height=T.height}async function ie(){if(!Z(c)){kt(c,!0),kt(I,"Fetching embeddings...");try{const A=await(await fetch("/api/embeddings?vectors=true")).json();if(A.error){kt(P,A.error,!0),kt(I,"");return}if(kt(M,A.embeddings||[],!0),Z(M).length===0||!Z(M)[0].vector){kt(I,""),Z(M).length>0&&kt(P,"No vector data available");return}kt(I,`Computing UMAP for ${Z(M).length} embeddings...`),await new Promise(Mt=>setTimeout(Mt,50));const ot=Z(M).map(Mt=>Mt.vector),ft=new Ai.UMAP({nComponents:2,nNeighbors:Math.min(15,Math.max(2,ot.length-1)),minDist:.1,spread:1});let gt;try{gt=ft.fit(ot)}catch(Mt){kt(P,`UMAP failed: ${Mt.message}`),kt(I,"");return}kt(I,"Building graph..."),await new Promise(Mt=>setTimeout(Mt,50));let Nt=1/0,dt=-1/0,vt=1/0,St=-1/0;for(const Mt of gt)Mt[0]<Nt&&(Nt=Mt[0]),Mt[0]>dt&&(dt=Mt[0]),Mt[1]<vt&&(vt=Mt[1]),Mt[1]>St&&(St=Mt[1]);const pt=dt-Nt||1,Rt=St-vt||1,Lt=400;kt(Q,Z(M).map((Mt,re)=>({x:((gt[re][0]-Nt)/pt-.5)*Lt,y:((gt[re][1]-vt)/Rt-.5)*Lt,radius:4+(Mt.importance||.5)*6,color:w[Mt.who]||w.unknown,data:Mt})),!0),kt(at,bt(gt,4).map(([Mt,re])=>({source:Mt,target:re})),!0),mt=js(Z(Q)).force("link",cs(Z(at)).distance(60).strength(.3)).force("charge",ks().strength(-80)).force("center",Yi(0,0)).force("collide",hs().radius(Mt=>Mt.radius+2)).alphaDecay(.02).on("tick",()=>{}),kt(I,""),await Nr(),Bt(),window.addEventListener("resize",Bt),H();const Pt=Z(R).getContext("2d");zt(Pt)}catch(T){kt(P,T.message||"Failed to load embeddings",!0),kt(I,"")}}}tr(()=>{Z(m)==="embeddings"&&Z(R)&&!Z(c)&&ie()}),tr(()=>{Z(m)==="embeddings"&&Z(R)&&Z(c)&&Nr().then(()=>Bt())});let $t=Zt(""),qt=Zt(er([])),Gt=Zt(!1),At=Zt(!1),le=mr(()=>Z(Gt)?Z(qt):u.data.memories??[]);async function me(){if(!Z($t).trim()){kt(qt,[],!0),kt(Gt,!1);return}kt(At,!0);try{const A=await(await fetch(`/memory/search?q=${encodeURIComponent(Z($t))}`)).json();kt(qt,A.results??[],!0),kt(Gt,!0)}finally{kt(At,!1)}}function ue(){kt($t,""),kt(qt,[],!0),kt(Gt,!1)}function ce(T){try{return new Date(T).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return T}}var fe=Js();ui("1uha8ag",T=>{Hn(()=>{ti.title="Signet Dashboard"})}),ii("keydown",ei,L);var ve=jt(fe),Xt=Dt(jt(ve),2),Yt=jt(Xt);{var ye=T=>{var A=Rs();Wt(T,A)},Jt=T=>{var A=Is();Wt(T,A)};we(Yt,T=>{Z(g)==="dark"?T(ye):T(Jt,!1)})}xt(Xt),xt(ve);var ee=Dt(ve,2),pe=jt(ee),he=Dt(jt(pe),4),de=jt(he),Oe=Dt(jt(de),2),ke=jt(Oe,!0);xt(Oe),xt(de);var Fe=Dt(de,2),Ge=Dt(jt(Fe),2),fr=jt(Ge,!0);xt(Ge),xt(Fe);var Je=Dt(Fe,2),Ze=Dt(jt(Je),2),cr=jt(Ze,!0);xt(Ze),xt(Je),xt(he);var Re=Dt(he,4);pr(Re,21,()=>u.data.harnesses??[],vr,(T,A)=>{var ot=Ps(),ft=jt(ot);{var gt=St=>{var pt=Ts();Wt(St,pt)},Nt=St=>{var pt=zs();Wt(St,pt)};we(ft,St=>{Z(A).exists?St(gt):St(Nt,!1)})}var dt=Dt(ft,2),vt=jt(dt,!0);xt(dt),xt(ot),ge(()=>Ht(vt,Z(A).name)),Wt(T,ot)}),xt(Re);var He=Dt(Re,4);pr(He,21,()=>u.data.configFiles??[],vr,(T,A)=>{const ot=mr(()=>Z(_)===Z(A).name);var ft=Cs();let gt;var Nt=jt(ft),dt=jt(Nt);{var vt=re=>{var Ee=Os();rr(3),Wt(re,Ee)},St=mr(()=>Y(Z(A).name)==="yaml"||Y(Z(A).name)==="yml"),pt=re=>{var Ee=Fs();rr(),Wt(re,Ee)};we(dt,re=>{Z(St)?re(vt):re(pt,!1)})}xt(Nt);var Rt=Dt(Nt,2),Lt=jt(Rt,!0);xt(Rt);var Pt=Dt(Rt,2),Mt=jt(Pt,!0);xt(Pt),xt(ft),ge(re=>{gt=dr(ft,1,"file-item svelte-1uha8ag",null,gt,{active:Z(ot)}),Ht(Lt,Z(A).name),Ht(Mt,re)},[()=>rt(Z(A).size)]),Ne("click",ft,()=>F(Z(A).name)),Wt(T,ft)}),xt(He),xt(pe);var Ce=Dt(pe,2),De=jt(Ce),Le=jt(De);let Me;var Ie=Dt(Le,2);let qe;var o=Dt(Ie,4);{var e=T=>{var A=Ls(),ot=nr(A),ft=jt(ot,!0);xt(ot);var gt=Dt(ot,2),Nt=jt(gt);{var dt=pt=>{var Rt=Ds();Wt(pt,Rt)};we(Nt,pt=>{Z(K)&&pt(dt)})}var vt=Dt(Nt,2),St=jt(vt,!0);xt(vt),xt(gt),ge(()=>{Ht(ft,Z(_)),vt.disabled=Z(V),Ht(St,Z(V)?"Saving...":"Save")}),Ne("click",vt,E),Wt(T,A)},r=T=>{var A=qs(),ot=Dt(nr(A),2),ft=jt(ot);xt(ot),ge(()=>Ht(ft,`${Z(M).length??""} embeddings`)),Wt(T,A)};we(o,T=>{Z(m)==="config"?T(e):T(r,!1)})}xt(De);var t=Dt(De,2);let n;var i=jt(t);ri(i),xt(t);var a=Dt(t,2);let l;var h=jt(a),f=jt(h);{var z=T=>{var A=Vs(),ot=jt(A),ft=jt(ot,!0);xt(ot),xt(A),ge(()=>Ht(ft,Z(I))),Wt(T,A)},p=T=>{var A=Bs(),ot=jt(A),ft=jt(ot,!0);xt(ot),xt(A),ge(()=>Ht(ft,Z(P))),Wt(T,A)},U=T=>{var A=$s();Wt(T,A)},it=T=>{var A=Us();Wt(T,A)};we(f,T=>{Z(I)?T(z):Z(P)?T(p,1):Z(c)&&Z(M).length===0?T(U,2):Z(c)||T(it,3)})}var $=Dt(f,2);si($,T=>kt(R,T),()=>Z(R)),xt(h),xt(a);var W=Dt(a,2),lt=jt(W);{var b=T=>{var A=As(),ot=nr(A),ft=jt(ot);xt(ot),rr(2),ge(gt=>Ht(ft,`${gt??""} Â· UTF-8`),[()=>Y(Z(_)).toUpperCase()]),Wt(T,A)},nt=T=>{var A=Ys(),ot=nr(A),ft=jt(ot);xt(ot),rr(2),ge(()=>Ht(ft,`${Z(Q).length??""} nodes Â· ${Z(at).length??""} edges`)),Wt(T,A)};we(lt,T=>{Z(m)==="config"?T(b):T(nt,!1)})}xt(W),xt(Ce);var ht=Dt(Ce,2),_t=jt(ht),Et=Dt(jt(_t),2),Ut=jt(Et,!0);xt(Et),xt(_t);var wt=Dt(_t,2),yt=jt(wt);vi(yt);var Vt=Dt(yt,2);{var k=T=>{var A=Ws();Ne("click",A,ue),Wt(T,A)};we(Vt,T=>{Z(Gt)&&T(k)})}xt(wt);var J=Dt(wt,2);{var ut=T=>{var A=Ks(),ot=jt(A);xt(A),ge(()=>Ht(ot,`${Z(qt).length??""} result${Z(qt).length===1?"":"s"}`)),Wt(T,A)};we(J,T=>{Z(Gt)&&T(ut)})}var et=Dt(J,2);pr(et,21,()=>Z(le),vr,(T,A)=>{var ot=Xs(),ft=jt(ot),gt=jt(ft,!0);xt(ft);var Nt=Dt(ft,2),dt=jt(Nt),vt=jt(dt,!0);xt(dt);var St=Dt(dt,2);{var pt=Pt=>{var Mt=Qs();Wt(Pt,Mt)};we(St,Pt=>{Z(A).importance&&Z(A).importance>=.9&&Pt(pt)})}var Rt=Dt(St,2),Lt=jt(Rt,!0);xt(Rt),xt(Nt),xt(ot),ge(Pt=>{Ht(gt,Z(A).content),Ht(vt,Z(A).who),Ht(Lt,Pt)},[()=>ce(Z(A).created_at)]),Wt(T,ot)},T=>{var A=Gs(),ot=jt(A,!0);xt(A),ge(()=>Ht(ot,Z(Gt)?"No results":"No memories yet")),Wt(T,A)}),xt(et),xt(ht),xt(ee),xt(fe),ge(()=>{Ht(ke,u.data.identity?.name??"Unknown"),Ht(fr,u.data.identity?.creature??"â"),Ht(cr,u.data.memoryStats?.total??0),Me=dr(Le,1,"tab svelte-1uha8ag",null,Me,{active:Z(m)==="config"}),qe=dr(Ie,1,"tab svelte-1uha8ag",null,qe,{active:Z(m)==="embeddings"}),n=qr(t,"",n,{visibility:Z(m)==="config"?"visible":"hidden",position:Z(m)==="config"?"relative":"absolute",inset:Z(m)==="config"?"auto":"0"}),l=qr(a,"",l,{visibility:Z(m)==="embeddings"?"visible":"hidden",position:Z(m)==="embeddings"?"relative":"absolute",inset:Z(m)==="embeddings"?"auto":"0"}),Ht(Ut,u.data.memoryStats?.total??0)}),Ne("click",Xt,v),Ne("click",Le,()=>kt(m,"config")),Ne("click",Ie,()=>kt(m,"embeddings")),Br(i,()=>Z(D),T=>kt(D,T)),Ne("keydown",yt,T=>{T.key==="Enter"&&me()}),Br(yt,()=>Z($t),T=>kt($t,T)),Wt(s,fe),Zn()}ni(["click","keydown"]);export{ro as component};
