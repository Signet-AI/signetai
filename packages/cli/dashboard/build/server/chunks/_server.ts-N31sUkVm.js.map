{"version":3,"file":"_server.ts-N31sUkVm.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/memory/search/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { join } from \"path\";\nimport { homedir } from \"os\";\nimport Database from \"better-sqlite3\";\nconst MEMORY_DB = join(homedir(), \".agents\", \"memory\", \"memories.db\");\nconst GET = async ({ url }) => {\n  const query = url.searchParams.get(\"q\") ?? \"\";\n  if (!query.trim()) {\n    return json({ results: [] });\n  }\n  try {\n    const db = new Database(MEMORY_DB, { readonly: true });\n    let results = [];\n    try {\n      results = db.prepare(`\n        SELECT m.id, m.content, m.created_at, m.who, m.importance, m.tags,\n               bm25(memories_fts) as score\n        FROM memories_fts\n        JOIN memories m ON memories_fts.rowid = m.rowid\n        WHERE memories_fts MATCH ?\n        ORDER BY score\n        LIMIT 20\n      `).all(query);\n    } catch {\n      results = db.prepare(`\n        SELECT id, content, created_at, who, importance, tags\n        FROM memories\n        WHERE content LIKE ? OR tags LIKE ?\n        ORDER BY created_at DESC\n        LIMIT 20\n      `).all(`%${query}%`, `%${query}%`);\n    }\n    db.close();\n    return json({ results });\n  } catch (e) {\n    console.error(\"Error searching memories:\", e);\n    return json({ results: [], error: \"Search failed\" });\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;AAIA,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,aAAa,CAAC;AAChE,MAAC,GAAG,GAAG,OAAO,EAAE,GAAG,EAAE,KAAK;AAC/B,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE;AAC/C,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE;AACrB,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;AAChC,EAAE;AACF,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,GAAG,IAAI,QAAQ,CAAC,SAAS,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;AAC1D,IAAI,IAAI,OAAO,GAAG,EAAE;AACpB,IAAI,IAAI;AACR,MAAM,OAAO,GAAG,EAAE,CAAC,OAAO,CAAC;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC;AACnB,IAAI,CAAC,CAAC,MAAM;AACZ,MAAM,OAAO,GAAG,EAAE,CAAC,OAAO,CAAC;AAC3B;AACA;AACA;AACA;AACA;AACA,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;AACxC,IAAI;AACJ,IAAI,EAAE,CAAC,KAAK,EAAE;AACd,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,CAAC;AAC5B,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE;AACd,IAAI,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,CAAC,CAAC;AACjD,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,eAAe,EAAE,CAAC;AACxD,EAAE;AACF;;;;"}